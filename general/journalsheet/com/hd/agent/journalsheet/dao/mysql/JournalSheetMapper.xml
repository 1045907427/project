<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hd.agent.journalsheet.dao.JournalSheetMapper" >
    <!-- 作废开始 -->
    <!-- 资金录入 -->
    <resultMap id="CapitalInputResultMap" type="com.hd.agent.journalsheet.model.CapitalInput" >
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="businessdate" property="businessdate" jdbcType="VARCHAR" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="supplierid" property="supplierid" jdbcType="VARCHAR" />
        <result column="suppliername" property="suppliername" jdbcType="VARCHAR" />
        <result column="supplierdeptid" property="supplierdeptid" jdbcType="VARCHAR" />
        <result column="subjectid" property="subjectid" jdbcType="VARCHAR" />
        <result column="subjectname" property="subjectname" jdbcType="VARCHAR" />
        <result column="subjectexpenses" property="subjectexpenses" jdbcType="DECIMAL" />
        <result column="adduserid" property="adduserid" jdbcType="VARCHAR" />
        <result column="addusername" property="addusername" jdbcType="VARCHAR" />
        <result column="addtime" property="addtime" jdbcType="TIMESTAMP" />
    </resultMap>
    <sql id="CapitalInput_Column_List" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                id, businessdate, remark, supplierid, suppliername, supplierdeptid, subjectid, subjectname,
                subjectexpenses, adduserid, addusername, addtime
            </when>
        </choose>
    </sql>
    <!-- 获取资金录入列表分页 -->
    <select id="getCapitalInputListPage" parameterType="com.hd.agent.common.util.PageMap" resultMap="CapitalInputResultMap">
        select
        <include refid="CapitalInput_Column_List"/>
        from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid = #{condition.supplierdeptid}
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>
    <!-- 获取资金录入列表分页数量 -->
    <select id="getCapitalInputListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid = #{condition.supplierdeptid}
            </if>
        </trim>
    </select>
    <!-- 根据查询条件获取货款合计 -->
    <select id="getCapitalInputSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(subjectexpenses) as subjectexpenses
        from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid = #{condition.supplierdeptid}
            </if>
        </trim>
    </select>
    <!-- 新增资金录入 -->
    <insert id="addCapitalInput" parameterType="com.hd.agent.journalsheet.model.CapitalInput">
        <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE" >
            select uuid_short()
        </selectKey>
        insert into t_js_capitalinput
        <trim prefix="(" suffix=")" suffixOverrides="," >
            id,
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="suppliername != null" >
                suppliername,
            </if>
            <if test="subjectid != null" >
                subjectid,
            </if>
            <if test="subjectname != null" >
                subjectname,
            </if>
            <if test="subjectexpenses != null" >
                subjectexpenses,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1 == 1" >
                addtime,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            #{id},
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="suppliername != null" >
                #{suppliername},
            </if>
            <if test="subjectid != null" >
                #{subjectid},
            </if>
            <if test="subjectname != null" >
                #{subjectname},
            </if>
            <if test="subjectexpenses != null" >
                #{subjectexpenses},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <if test="1 == 1" >
                now(),
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
        </trim>
    </insert>
    <delete id="deleteCapitalInputBySupplieridAndSubjectid" parameterType="java.lang.String">
        delete from t_js_capitalinput where supplierid=#{supplierid} and subjectid=#{subjectid}
    </delete>
    <!-- 修改资金录入 -->
    <update id="editCapitalInput" parameterType="com.hd.agent.journalsheet.model.CapitalInput">
        update t_js_capitalinput
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="suppliername != null" >
                suppliername = #{suppliername},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="subjectid != null" >
                subjectid = #{subjectid},
            </if>
            <if test="subjectname != null" >
                subjectname = #{subjectname},
            </if>
            <if test="subjectexpenses != null" >
                subjectexpenses = #{subjectexpenses},
            </if>
        </set>
        where id = #{id}
    </update>
    <!-- 删除资金录入 -->
    <delete id="deleteCapitalInput" parameterType="java.lang.String">
        delete from t_js_capitalinput
        where id = #{id}
    </delete>
    <!-- 删除所有资金录入数据 -->
    <delete id="deleteCapitalInputAll">
        delete from t_js_capitalinput
    </delete>
    <!-- 获取资金录入详情 -->
    <select id="getCapitalInputDetail" parameterType="map" resultMap="CapitalInputResultMap">
        select
        <include refid="CapitalInput_Column_List"/>
        from t_js_capitalinput
        where id = #{id}
    </select>

    <!-- 资金统计报表 -->

    <!-- 资金录入下的供应商列表（不重复）,获取报表分类 -->
    <select id="getCapitalStatisticsBySupplier" parameterType="com.hd.agent.common.util.PageMap" resultMap="CapitalInputResultMap">
        SELECT DISTINCT supplierid,suppliername,supplierdeptid
        FROM t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>
    <!-- 资金录入下的供应商数量（不重复）,获取报表分类数量 -->
    <select id="getCapitalStatisticsBySupplierCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        SELECT DISTINCT supplierid,suppliername,supplierdeptid
        FROM t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        ) t
    </select>
    <!-- 根据供应商和资金科目获取资金合计金额 -->
    <select id="getCapitalAmountBySupplierAndPriceSubject" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(subjectexpenses) from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
    </select>
    <!-- 根据供应商编号获取合计金额（资金统计报表合计金额与统计报表实际占用金额关联） -->
    <select id="getRetruntCapitalAmount" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(subjectexpenses) from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid =#{condition.subjectid}
            </if>
        </trim>
    </select>
    <!-- 根据资金科目获取科目货款合计金额 -->
    <select id="getCapitalStatisticsQuerySumByPriceSubject" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid =#{condition.subjectid}
            </if>
        </trim>
    </select>
    <!-- 根据资金科目获取其总金额 -->
    <select id="getCapitalStatisticsAllSumByPriceSubejct" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid =#{condition.subjectid}
            </if>
        </trim>
    </select>
    <!-- 获取所有数据的合计金额 -->
    <select id="getCapitalStatisticsAllSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
        </trim>
    </select>
    <!-- 根据供应商编号等条件，获取货款明细 -->
    <select id="getCapitalStatisticsDetailList" parameterType="com.hd.agent.common.util.PageMap" resultMap="CapitalInputResultMap">
        SELECT id, businessdate, remark, supplierid, suppliername, supplierdeptid, subjectid, subjectname,
        subjectexpenses, adduserid, addusername, addtime
        FROM t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        order by businessdate
    </select>

    <!-- 根据科目分类获取科目货款总和列表分页 -->
    <select id="getCapitalStatisticsSheetList" parameterType="com.hd.agent.common.util.PageMap" resultMap="CapitalInputResultMap">
        select id, businessdate, remark, supplierid, suppliername, supplierdeptid, subjectid, subjectname,
        SUM(subjectexpenses) as accountprice, adduserid, addusername, addtime
        from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid in
                <foreach collection="condition.array" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= DATE_ADD(STR_TO_DATE(#{condition.endtime},'%Y-%m-%d'),INTERVAL 1 DAY)]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid =#{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        GROUP BY subjectid
        <include refid="common.Page_limit" />
    </select>
    <!-- 根据科目分类获取科目货款总和列表分页数量 -->
    <select id="getCapitalStatisticsSheetCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) FROM (
        select supplierid
        from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid in
                <foreach collection="condition.array" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= DATE_ADD(STR_TO_DATE(#{condition.endtime},'%Y-%m-%d'),INTERVAL 1 DAY)]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid =#{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        ) t
    </select>
    <!-- 根据供应商编码和资金科目编码获取金额总数 -->
    <select id="getAmountBySupplierAndPriceSubject" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(subjectexpenses) from t_js_capitalinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
    </select>

    <!-- 作废结束 -->

    <!-- 资金录入（t_js_fundinput） -->
    <resultMap id="FundInputResultMap" type="com.hd.agent.journalsheet.model.FundInput" >
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="businessdate" property="businessdate" jdbcType="VARCHAR" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="supplierid" property="supplierid" jdbcType="VARCHAR" />
        <result column="supplierdeptid" property="supplierdeptid" jdbcType="VARCHAR" />
        <result column="advanceamount" property="advanceamount" jdbcType="DECIMAL" />
        <result column="stockamount" property="stockamount" jdbcType="DECIMAL" />
        <result column="receivableamount" property="receivableamount" jdbcType="DECIMAL" />
        <result column="actingmatamount" property="actingmatamount" jdbcType="DECIMAL" />
        <result column="payableamount" property="payableamount" jdbcType="DECIMAL" />
        <result column="norecactingmat" property="norecactingmat" jdbcType="DECIMAL" />
        <result column="norecexpenses" property="norecexpenses" jdbcType="DECIMAL" />
        <result column="stockdiscount" property="stockdiscount" jdbcType="DECIMAL" />
        <result column="currentactingmat" property="currentactingmat" jdbcType="DECIMAL" />
        <result column="remittancerecovery" property="remittancerecovery" jdbcType="DECIMAL" />
        <result column="goodsrecovery" property="goodsrecovery" jdbcType="DECIMAL" />
        <result column="totalamount" property="totalamount" jdbcType="DECIMAL" />
        <result column="sumamount" property="sumamount" jdbcType="DECIMAL" />
        <result column="sumactingmat" property="sumactingmat" jdbcType="DECIMAL" />
        <result column="sumreceivable" property="sumreceivable" jdbcType="DECIMAL" />
        <result column="sumnorec" property="sumnorec" jdbcType="DECIMAL" />
        <result column="adduserid" property="adduserid" jdbcType="VARCHAR" />
        <result column="addusername" property="addusername" jdbcType="VARCHAR" />
        <result column="addtime" property="addtime" jdbcType="VARCHAR" />
        <result column="state" property="state" jdbcType="CHAR" />
    </resultMap>
    <sql id="FundInput_Column_List" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                id, businessdate, remark, supplierid, supplierdeptid,
                advanceamount, stockamount,receivableamount, actingmatamount, payableamount,
                norecactingmat,norecexpenses,stockdiscount,currentactingmat,remittancerecovery,goodsrecovery,
                totalamount,sumamount,sumactingmat,sumreceivable,sumnorec,
                adduserid, addusername, addtime, state
            </when>
        </choose>
    </sql>
    <!-- 获取资金录入列表分页 -->
    <sql id="fundInputList_sql">
        (
        select id, businessdate, remark, supplierid, supplierdeptid,adduserid, addusername, addtime, state,
        advanceamount, stockamount,receivableamount, actingmatamount, payableamount,totalamount,
        norecactingmat,norecexpenses,stockdiscount,currentactingmat,remittancerecovery,goodsrecovery
        from t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.state != null" >
                and state = #{condition.state}
            </if>
        </trim>
        )
    </sql>
    <!-- 获取资金录入列表分页 -->
    <select id="getFundInputListPage" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        select z.* from <include refid="fundInputList_sql"/> z
        <include refid="common.Page_OrderOnly"/>
        <if test="condition.isflag == null">
            <include refid="common.Page_LimitOnly"/>
        </if>

    </select>
    <!-- 获取资金录入列表分页数量 -->
    <select id="getFundInputListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from <include refid="fundInputList_sql"/> z
    </select>
    <!-- 根据查询条件获取各项资金合计 -->
    <select id="getFundInputSum" resultMap="FundInputResultMap">
        select sum(y.advanceamount) as advanceamount, sum(y.stockamount) as stockamount, sum(y.receivableamount) as receivableamount,
        sum(y.actingmatamount) as actingmatamount, sum(y.payableamount) as payableamount,sum(y.totalamount) as totalamount,
        sum(y.norecactingmat) as norecactingmat,sum(y.norecexpenses) as norecexpenses,sum(y.stockdiscount) as stockdiscount,
        sum(y.currentactingmat) as currentactingmat,sum(y.remittancerecovery) as remittancerecovery,sum(y.goodsrecovery) as goodsrecovery
        from <include refid="fundInputList_sql"/> y
    </select>
    <select id="getLastFundInputSum" parameterType="java.lang.String" resultType="com.hd.agent.journalsheet.model.FundInput">
        SELECT sum(t.currentactingmat) as currentactingmat,sum(t.remittancerecovery) as remittancerecovery,sum(t.goodsrecovery) as goodsrecovery
        from t_js_fundinput t
        where t.state = '0' and t.supplierid = #{supplierid}
        <![CDATA[and t.businessdate <= STR_TO_DATE(#{businessdate},'%Y-%m-%d')]]>
    </select>
    <select id="getMaxDateMinDateFundInput" parameterType="java.util.Map" resultType="map">
        SELECT MAX(t.businessdate) as maxdate,min(t.businessdate) as mindate
        from t_js_fundinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="supplierid != null" >
                and t.supplierid = #{supplierid}
            </if>
        </trim>
    </select>

    <!-- 新增资金录入 -->
    <insert id="addFundInput" parameterType="com.hd.agent.journalsheet.model.FundInput">
        <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE" >
            select uuid_short()
        </selectKey>
        insert into t_js_fundinput
        <trim prefix="(" suffix=")" suffixOverrides="," >
            id,
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
            <if test="advanceamount != null" >
                advanceamount,
            </if>
            <if test="stockamount != null" >
                stockamount,
            </if>
            <if test="receivableamount != null" >
                receivableamount,
            </if>
            <if test="actingmatamount != null" >
                actingmatamount,
            </if>
            <if test="payableamount != null" >
                payableamount,
            </if>
            <if test="norecactingmat != null" >
                norecactingmat,
            </if>
            <if test="norecexpenses != null" >
                norecexpenses,
            </if>
            <if test="stockdiscount != null" >
                stockdiscount,
            </if>
            <if test="currentactingmat != null" >
                currentactingmat,
            </if>
            <if test="remittancerecovery != null" >
                remittancerecovery,
            </if>
            <if test="goodsrecovery != null" >
                goodsrecovery,
            </if>
            <if test="totalamount != null" >
                totalamount,
            </if>
            <if test="sumamount != null" >
                sumamount,
            </if>
            <if test="sumactingmat != null" >
                sumactingmat,
            </if>
            <if test="sumreceivable != null" >
                sumreceivable,
            </if>
            <if test="sumnorec != null" >
                sumnorec,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1 == 1" >
                addtime,
            </if>
            <if test="1 == 1" >
                state,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            #{id},
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
            <if test="advanceamount != null" >
                #{advanceamount},
            </if>
            <if test="stockamount != null" >
                #{stockamount},
            </if>
            <if test="receivableamount != null" >
                #{receivableamount},
            </if>
            <if test="actingmatamount != null" >
                #{actingmatamount},
            </if>
            <if test="payableamount != null" >
                #{payableamount},
            </if>
            <if test="norecactingmat != null" >
                #{norecactingmat},
            </if>
            <if test="norecexpenses != null" >
                #{norecexpenses},
            </if>
            <if test="stockdiscount != null" >
                #{stockdiscount},
            </if>
            <if test="currentactingmat != null" >
                #{currentactingmat},
            </if>
            <if test="remittancerecovery != null" >
                #{remittancerecovery},
            </if>
            <if test="goodsrecovery != null" >
                #{goodsrecovery},
            </if>
            <if test="totalamount != null" >
                #{totalamount},
            </if>
            <if test="sumamount != null" >
                #{sumamount},
            </if>
            <if test="sumactingmat != null" >
                #{sumactingmat},
            </if>
            <if test="sumreceivable != null" >
                #{sumreceivable},
            </if>
            <if test="sumnorec != null" >
                #{sumnorec},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <if test="1 == 1" >
                now(),
            </if>
            <if test="1 == 1" >
                '1',
            </if>
        </trim>
    </insert>
    <!-- 修改资金录入 -->
    <update id="editFundInput" parameterType="com.hd.agent.journalsheet.model.FundInput">
        update t_js_fundinput
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="advanceamount != null" >
                advanceamount = #{advanceamount},
            </if>
            <if test="stockamount != null" >
                stockamount = #{stockamount},
            </if>
            <if test="receivableamount != null" >
                receivableamount = #{receivableamount},
            </if>
            <if test="actingmatamount != null" >
                actingmatamount = #{actingmatamount},
            </if>
            <if test="payableamount != null" >
                payableamount = #{payableamount},
            </if>
            <if test="norecactingmat != null" >
                norecactingmat = #{norecactingmat},
            </if>
            <if test="norecexpenses != null" >
                norecexpenses = #{norecexpenses},
            </if>
            <if test="stockdiscount != null" >
                stockdiscount = #{stockdiscount},
            </if>
            <if test="currentactingmat != null" >
                currentactingmat = #{currentactingmat},
            </if>
            <if test="remittancerecovery != null" >
                remittancerecovery = #{remittancerecovery},
            </if>
            <if test="goodsrecovery != null" >
                goodsrecovery = #{goodsrecovery},
            </if>
            <if test="totalamount != null" >
                totalamount = #{totalamount},
            </if>
            <if test="sumamount != null" >
                sumamount = #{sumamount},
            </if>
            <if test="sumactingmat != null" >
                sumactingmat = #{sumactingmat},
            </if>
            <if test="sumreceivable != null" >
                sumreceivable = #{sumreceivable},
            </if>
            <if test="sumnorec != null" >
                sumnorec = #{sumnorec},
            </if>
        </set>
        where id = #{id}
    </update>
    <!-- 删除资金录入 -->
    <delete id="deleteFundInput" parameterType="java.lang.String">
        delete from t_js_fundinput
        where id = #{id}
    </delete>
    <!-- 根据供应商编码修改资金录入 -->
    <update id="editFundInputBySupplierid" parameterType="java.lang.String">
        update t_js_fundinput set state = '0'
        where supplierid = #{supplierid}
    </update>
    <!-- 获取资金录入详情 -->
    <select id="getFundInputDetail" parameterType="java.util.Map" resultMap="FundInputResultMap">
        select
        <include refid="FundInput_Column_List"/>
        from t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="id != null">
                and id = #{id}
            </if>
            <if test="businessdate != null">
                and businessdate = #{businessdate}
            </if>
            <if test="supplierid != null" >
                and supplierid = #{supplierid}
            </if>
            <if test="state != null" >
                and state = #{state}
            </if>
        </trim>
    </select>
    <!--根据供应商编码判断是否存在该资金录入 -->
    <select id="checkFundInputBySupplierid" parameterType="java.lang.String" resultType="int">
        select count(1) from t_js_fundinput
        where supplierid = #{supplierid}
    </select>
    <select id="checkFundInputBySupplieridAndDate" parameterType="java.lang.String" resultType="int">
        select count(1) from t_js_fundinput
        where supplierid = #{supplierid} and businessdate = #{businessdate}
    </select>
    <select id="checkFundInputByMap" parameterType="java.util.Map" resultType="int">
        select count(1) from t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="businessdate != null">
                and businessdate = #{businessdate}
            </if>
            <if test="supplierid != null" >
                and supplierid = #{supplierid}
            </if>
            <if test="state != null" >
                and state = #{state}
            </if>
        </trim>
    </select>
    <delete id="deleteFundInputBySupplieridAndDate" parameterType="java.lang.String">
        delete from t_js_fundinput
        where supplierid = #{supplierid} and businessdate = #{businessdate}
    </delete>

    <insert id="addFundinputHisJob" parameterType="java.lang.String">
        insert into t_js_fundinput_h
        select * from t_js_fundinput t
        where t.id=#{id}
    </insert>
    <delete id="deleteFundInputHis" parameterType="java.lang.String">
        delete from t_js_fundinput_h where id=#{id}
    </delete>
    <select id="getFundinputHisList" parameterType="java.lang.String" resultType="com.hd.agent.journalsheet.model.FundInput">
        select * from (select * from t_js_fundinput t
        <![CDATA[where t.businessdate<=#{date} ]]>
        and t.state='1'
        ORDER By t.addtime desc
        ) z
        GROUP BY z.supplierid
    </select>
    <update id="updateFundInputHisState" parameterType="java.lang.String">
        update t_js_fundinput_h set state='1'
    </update>
    <select id="getFundInputHisData" parameterType="java.lang.String">
        select * from t_js_fundinput_h t where t.id=#{id}
    </select>
    <delete id="deleteTotalFundInputHis">
        TRUNCATE t_js_fundinput_h
    </delete>
    <!-- 资金统计报表（t_js_fundinput） -->
    <sql id="getFundStatisticsSheetList_sql">
      (
        select t.businessdate, t.supplierid, t.supplierdeptid,t.state,
        t.advanceamount, t.stockamount,t.receivableamount, t.actingmatamount, t.payableamount,t.totalamount,
        t.norecactingmat,t.norecexpenses,t.stockdiscount,t.currentactingmat,t.remittancerecovery,t.goodsrecovery,
        t.sumamount,t.sumactingmat,t.sumreceivable,t.sumnorec
        from t_js_fundinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.versionstr == 0">
                and t.state = '1'
            </if>
            <if test="condition.begintime != null">
                and t.businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and t.businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and t.supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and t.supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <choose>
                <when test="condition.type == 1">
                    and t.totalamount != 0
                </when>
                <when test="condition.type == 2">
                    and t.totalamount = 0
                </when>
            </choose>
        </trim>
      )
    </sql>
    <select id="getFundStatisticsSheetList" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        SELECT z.* from <include refid="getFundStatisticsSheetList_sql"/> z
        <include refid="common.Page_OrderOnly"/>
        <if test="condition.isflag == null">
            <include refid="common.Page_LimitOnly"/>
        </if>
    </select>
    <select id="getFundStatisticsSheetListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        SELECT count(1) from <include refid="getFundStatisticsSheetList_sql"/> z
    </select>
    <select id="getFundStatisticsSheetListSum" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        select sum(z.advanceamount) as advanceamount, sum(z.stockamount) as stockamount, sum(z.receivableamount) as receivableamount,
        sum(z.actingmatamount) as actingmatamount, sum(z.payableamount) as payableamount,sum(z.totalamount) as totalamount,
        sum(z.norecactingmat) as norecactingmat,sum(z.norecexpenses) as norecexpenses,sum(z.stockdiscount) as stockdiscount,
        sum(z.currentactingmat) as currentactingmat,sum(z.remittancerecovery) as remittancerecovery,sum(z.goodsrecovery) as goodsrecovery,
        sum(z.sumamount) as sumamount,sum(z.sumactingmat) as sumactingmat,sum(z.sumreceivable) as sumreceivable,sum(z.sumnorec) as sumnorec
        from <include refid="getFundStatisticsSheetList_sql"/> z
    </select>

    <!-- 资金录入下的供应商列表（不重复）,获取报表分类 -->
    <select id="getFundStatisticsBySupplier" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        SELECT DISTINCT supplierid,supplierdeptid
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="1 == 1" >
                and state = '1'
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>
    <!-- 资金录入下的供应商数量（不重复）,获取报表分类数量 -->
    <select id="getFundStatisticsBySupplierCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        SELECT DISTINCT supplierid,supplierdeptid
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="1 == 1" >
                and state = '1'
            </if>
        </trim>
        ) t
    </select>
    <!-- 根据供应商获取各项资金合计金额 -->
    <select id="getFundAmountBySupplier" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        select sum(advanceamount) as advanceamount, sum(stockamount) as stockamount, sum(receivableamount) as receivableamount,
        sum(actingmatamount) as actingmatamount, sum(payableamount) as payableamount
        from t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="1 == 1" >
                and state = '1'
            </if>
        </trim>
    </select>
    <!-- 获取所有各项资金总和 -->
    <select id="getTotalFundAmountByPageMap" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        select sum(advanceamount) as advanceamount, sum(stockamount) as stockamount, sum(receivableamount) as receivableamount,
        sum(actingmatamount) as actingmatamount, sum(payableamount) as payableamount
        from t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="condition.datasql1 !=null">
                and ${condition.datasql1}
            </if>
            <if test="1 == 1" >
                and state = '1'
            </if>
        </trim>
    </select>

    <sql id="getAverageDataGroupBySupplierList_sql">
        (
        SELECT t.supplierid,t.supplierdeptid,AVG(t.advanceamount) as advanceamount,AVG(t.stockamount) as stockamount,
        AVG(t.receivableamount) as receivableamount,AVG(t.actingmatamount) as actingmatamount,AVG(t.payableamount) as payableamount,
        AVG(t.totalamount) as totalamount,AVG(t.stockdiscount) as stockdiscount,AVG(t.norecactingmat) as norecactingmat,
        AVG(t.norecexpenses) as norecexpenses,AVG(t.sumamount) as sumamount,AVG(t.currentactingmat) as currentactingmat,
        AVG(t.sumactingmat) as sumactingmat,AVG(t.remittancerecovery) as remittancerecovery,AVG(t.goodsrecovery) as goodsrecovery,
        AVG(t.sumreceivable) as sumreceivable,AVG(t.sumnorec) as sumnorec
        from t_js_fundinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and t.businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and t.businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and t.supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and t.supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.businessyearmonth != null">
                <![CDATA[and t.businessdate like CONCAT(#{condition.businessyearmonth},'%')]]>
            </if>
        </trim>
        GROUP BY t.supplierid
        )
    </sql>
    <!-- 资金平均金额统计报表 -->
    <select id="getAverageDataGroupBySupplierList" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        SELECT z.* from <include refid="getAverageDataGroupBySupplierList_sql"/> z
        <if test="condition.isflag == null">
            <include refid="common.Page_limit"/>
        </if>
    </select>
    <select id="getAverageDataGroupBySupplierCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from <include refid="getAverageDataGroupBySupplierList_sql"/> z
    </select>
    <select id="getAverageDataGroupBySupplierMapList" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        select z.supplierid,z.supplierdeptid,z.advanceamount,z.stockamount,z.receivableamount,z.actingmatamount,z.payableamount,
          z.totalamount,z.stockdiscount,z.norecactingmat,z.norecexpenses,z.sumamount,z.currentactingmat,z.sumactingmat,
          z.remittancerecovery,z.goodsrecovery,z.sumreceivable,z.sumnorec
        from <include refid="getAverageDataGroupBySupplierList_sql"/> z
        GROUP BY supplierid
    </select>
    <select id="getSumAvgDataGroupBySupplier" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        select sum(z.advanceamount) as advanceamount,sum(z.stockamount) as stockamount,sum(z.receivableamount) as receivableamount,
        sum(z.actingmatamount) as actingmatamount,sum(z.payableamount) as payableamount,sum(z.totalamount) as totalamount,
        sum(z.norecactingmat) as norecactingmat,sum(z.norecexpenses) as norecexpenses,sum(z.stockdiscount) as stockdiscount,
        sum(z.currentactingmat) as currentactingmat,sum(z.remittancerecovery) as remittancerecovery,sum(z.goodsrecovery) as goodsrecovery,
        sum(z.sumamount) as sumamount,sum(z.sumactingmat) as sumactingmat,sum(z.sumreceivable) as sumreceivable,sum(z.sumnorec) as sumnorec
        from <include refid="getAverageDataGroupBySupplierList_sql"/> z
    </select>
    <select id="getSumAllAvgData" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        select sum(z.advanceamount) as advanceamount,sum(z.stockamount) as stockamount,sum(z.receivableamount) as receivableamount,
        sum(z.actingmatamount) as actingmatamount,sum(z.payableamount) as payableamount,sum(z.totalamount) as totalamount,
        sum(z.norecactingmat) as norecactingmat,sum(z.norecexpenses) as norecexpenses,sum(z.stockdiscount) as stockdiscount,
        sum(z.currentactingmat) as currentactingmat,sum(z.remittancerecovery) as remittancerecovery,sum(z.goodsrecovery) as goodsrecovery,
        sum(z.sumamount) as sumamount,sum(z.sumactingmat) as sumactingmat,sum(z.sumreceivable) as sumreceivable,sum(z.sumnorec) as sumnorec
        from <include refid="getAverageDataGroupBySupplierList_sql"/> z
    </select>

    <!-- 获取所有不同供应商列表 -->
    <select id="getAllSupplierFromFundAverage" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        SELECT DISTINCT supplierid,supplierdeptid
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        <if test="condition.isflag == null">
            <include refid="common.Page_limit"/>
        </if>
    </select>
    <!-- 获取获取所有不同供应商列表数量 -->
    <select id="getAllSupplierFromFundAverageCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        SELECT DISTINCT supplierid,supplierdeptid
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        ) t
    </select>
    <!-- 根据查询条件获取资金个数 -->
    <select id="getFundInputCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.state != null" >
                and state = #{condition.state}
            </if>
        </trim>
    </select>
    <!-- 获取所有各项资金总和 -->
    <select id="getTotalFundAmount" resultMap="FundInputResultMap">
        select sum(advanceamount) as advanceamount, sum(stockamount) as stockamount, sum(receivableamount) as receivableamount,
        sum(actingmatamount) as actingmatamount, sum(payableamount) as payableamount
        from t_js_fundinput
    </select>
    <select id="getTotalFundCount" resultType="int">
        select count(1) from t_js_fundinput
    </select>
    <!-- 根据供应商编号等条件，获取资金录入明细 -->
    <select id="getFundStatisticsDetailList" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        SELECT z.* from <include refid="getFundStatisticsSheetList_sql"/> z
        order by z.businessdate
        <if test="condition.isflag == null">
            <include refid="common.Page_limit"/>
        </if>
    </select>
    <select id="getFundStatisticsDetailListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from <include refid="getFundStatisticsSheetList_sql"/> z
    </select>
    <select id="getTotalFundDetailAmount" parameterType="com.hd.agent.common.util.PageMap" resultMap="FundInputResultMap">
        SELECT AVG(t.advanceamount) as advanceamount,AVG(t.stockamount) as stockamount,
        AVG(t.receivableamount) as receivableamount,AVG(t.actingmatamount) as actingmatamount,AVG(t.payableamount) as payableamount,
        AVG(t.totalamount) as totalamount,AVG(t.stockdiscount) as stockdiscount,AVG(t.norecactingmat) as norecactingmat,
        AVG(t.norecexpenses) as norecexpenses,AVG(t.sumamount) as sumamount,AVG(t.currentactingmat) as currentactingmat,
        AVG(t.sumactingmat) as sumactingmat,AVG(t.remittancerecovery) as remittancerecovery,AVG(t.goodsrecovery) as goodsrecovery,
        AVG(t.sumreceivable) as sumreceivable,AVG(t.sumnorec) as sumnorec
        FROM t_js_fundinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and t.businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and t.businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and t.supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and t.supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
    </select>

    <!-- 货款录入 -->
    <resultMap id="ExpensesEnteringResultMap" type="com.hd.agent.journalsheet.model.ExpensesEntering" >
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="businessdate" property="businessdate" jdbcType="VARCHAR" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="supplierid" property="supplierid" jdbcType="VARCHAR" />
        <result column="suppliername" property="suppliername" jdbcType="VARCHAR" />
        <result column="supplierdeptid" property="supplierdeptid" jdbcType="VARCHAR" />
        <result column="subjectid" property="subjectid" jdbcType="VARCHAR" />
        <result column="subjectname" property="subjectname" jdbcType="VARCHAR" />
        <result column="subjectexpenses" property="subjectexpenses" jdbcType="DECIMAL" />
        <result column="adduserid" property="adduserid" jdbcType="VARCHAR" />
        <result column="addusername" property="addusername" jdbcType="VARCHAR" />
        <result column="addtime" property="addtime" jdbcType="TIMESTAMP" />
        <result column="vouchertimes" property="vouchertimes" jdbcType="INTEGER" />
    </resultMap>
    <sql id="ExpensesEntering_Column_List" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                id, businessdate, remark, supplierid, suppliername, supplierdeptid, subjectid, subjectname,
                subjectexpenses, adduserid, addusername, addtime,vouchertimes
            </when>
        </choose>
    </sql>
    <!-- 获取货款录入列表分页 -->
    <select id="getExpensesEnteringListPage" parameterType="com.hd.agent.common.util.PageMap" resultMap="ExpensesEnteringResultMap">
        select
        <include refid="ExpensesEntering_Column_List"/>
        from
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.addtime1 != null">
                and ADDTIME >= STR_TO_DATE(#{condition.addtime1},'%Y-%m-%d')
            </if>
            <if test="condition.addtime2 != null">
                <![CDATA[and ADDTIME <= DATE_ADD(STR_TO_DATE(#{condition.addtime2},'%Y-%m-%d'),INTERVAL 1 DAY)]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>
    <!-- 获取货款录入列表分页数量 -->
    <select id="getExpensesEnteringListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.addtime1 != null">
                and ADDTIME >= STR_TO_DATE(#{condition.addtime1},'%Y-%m-%d')
            </if>
            <if test="condition.addtime2 != null">
                <![CDATA[and ADDTIME <= DATE_ADD(STR_TO_DATE(#{condition.addtime2},'%Y-%m-%d'),INTERVAL 1 DAY)]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
    </select>
    <!-- 根据查询条件获取货款合计 -->
    <select id="getExpensesEnteringSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(subjectexpenses) as subjectexpenses
        from
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
    </select>
    <!-- 新增货款录入 -->
    <insert id="addExpensesEntering" parameterType="com.hd.agent.journalsheet.model.ExpensesEntering">
        <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE" >
            select uuid_short()
        </selectKey>
        insert into t_finance_expensesentering
        <trim prefix="(" suffix=")" suffixOverrides="," >
            id,
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="suppliername != null" >
                suppliername,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
            <if test="subjectid != null" >
                subjectid,
            </if>
            <if test="subjectname != null" >
                subjectname,
            </if>
            <if test="subjectexpenses != null" >
                subjectexpenses,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1 == 1" >
                addtime,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            #{id},
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="suppliername != null" >
                #{suppliername},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
            <if test="subjectid != null" >
                #{subjectid},
            </if>
            <if test="subjectname != null" >
                #{subjectname},
            </if>
            <if test="subjectexpenses != null" >
                #{subjectexpenses},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <if test="1 == 1" >
                now(),
            </if>
        </trim>
    </insert>
    <!-- 修改货款录入 -->
    <update id="editExpensesEntering" parameterType="com.hd.agent.journalsheet.model.ExpensesEntering">
        update t_finance_expensesentering
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="suppliername != null" >
                suppliername = #{suppliername},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="subjectid != null" >
                subjectid = #{subjectid},
            </if>
            <if test="subjectname != null" >
                subjectname = #{subjectname},
            </if>
            <if test="subjectexpenses != null" >
                subjectexpenses = #{subjectexpenses},
            </if>
        </set>
        where id = #{id}
    </update>
    <select id="getSupplierExpenseSumData" resultType="java.util.Map">
        select businessdate,supplierid,sum(subjectexpenses) as taxamount,count(id) as billnums
        from t_finance_expensesentering
        where subjectid='3'
        <if test="list != null">
            and id in
            <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="list == null">
            1>2
        </if>
        group by supplierid,businessdate
    </select>
    <select id="getSupplierExpenseSumDataForThird" resultType="java.util.Map">
        select businessdate,supplierid,subjectexpenses as taxamount,subjectid,subjectexpenses as costsort
        from t_finance_expensesentering
        where subjectid='3'
        <if test="list != null">
            and id in
            <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="list == null">
            1>2
        </if>

    </select>
    <!-- 删除货款录入 -->
    <delete id="deleteExpensesEntering" parameterType="java.lang.String">
        delete from t_finance_expensesentering
        where id = #{id}
    </delete>
    <!-- 获取货款录入详情 -->
    <select id="getExpensesEnteringDetail" parameterType="map" resultMap="ExpensesEnteringResultMap">
        select
        <include refid="ExpensesEntering_Column_List"/>
        from t_finance_expensesentering
        where id = #{id}
    </select>
    <!-- 判断供应商编码是否被使用 -->
    <select id="isUsedSupplierid" resultType="int" parameterType="java.lang.String">
        select count(1) from t_finance_expensesentering where supplierid = #{supplierid}
    </select>
    <!-- 判断科目编码是否被使用 -->
    <select id="isUsedSubjectid" resultType="int" parameterType="java.lang.String">
        select count(1) from t_finance_expensesentering where subjectid = #{subjectid}
    </select>

    <!-- 分科目开单流水账列表 -->
    <select id="getSubjectDayAccountList" parameterType="com.hd.agent.common.util.PageMap" resultMap="ExpensesEnteringResultMap">
        SELECT id, supplierid, businessdate, remark, suppliername, supplierdeptid, subjectid, subjectname, adduserid, addusername, subjectexpenses ,ADDTIME
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
        <include refid="common.Page_OrderOnly"/>
    </select>
    <select id="getSubjectQuerySum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM t_finance_expensesentering
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
    </select>
    <select id="getSubjectAllSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
    </select>
    <select id="getSupplierListBySubjectid" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.ExpensesEntering">
        SELECT DISTINCT supplierid,suppliername,supplierdeptid
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>

        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>
    <select id="getSupplierListCountBySubjectid"  parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        SELECT count(1) from (
        select DISTINCT supplierid,suppliername,supplierdeptid
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>) t
    </select>
    <!-- 分科目开单流水账分页数量 -->
    <select id="getClienteleDayAccountList" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.ExpensesEntering">
        SELECT id, supplierid, businessdate, remark, suppliername, supplierdeptid, subjectid, subjectname, adduserid, addusername, sum(subjectexpenses) as subjectexpenses,ADDTIME
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.array != null" >
                and subjectid in
                <foreach collection="condition.array" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        group by supplierid,subjectid
    </select>
    <select id="getClienteleDayAccountDetailList" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.ExpensesEntering">
        SELECT id, supplierid, businessdate, remark, suppliername, supplierdeptid, subjectid, subjectname, adduserid, addusername, subjectexpenses,ADDTIME
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
        order by businessdate
    </select>
    <!-- 根据供应商编码获取报表分类 -->
    <select id="getStatisticslistBySupplierid" parameterType="com.hd.agent.common.util.PageMap" resultMap="ExpensesEnteringResultMap">
        SELECT DISTINCT supplierid,suppliername,supplierdeptid
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        <if test="condition.isflag == null">
            <include refid="common.Page_limit"/>
        </if>
    </select>
    <select id="getStatisticslistBySupplieridCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        SELECT DISTINCT supplierid,suppliername, supplierdeptid
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        ) t
    </select>
    <select id="getStatisticsListData" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">
        select z.supplierid,z.supplierdeptid,sum(z.lastamount) as lastAmount,sum(z.realatamount) as realatamount,t1.price as approvalAmount,(sum(z.realatamount) - sum(z.lastamount)) as settleamount
        from(
        SELECT supplierid,supplierdeptid,subjectexpenses as lastamount,0 as realatamount
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        UNION ALL
        select supplierid,supplierdeptid,0 as lastamount,
        (advanceamount+stockamount+receivableamount+actingmatamount+payableamount) as realatamount
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="condition.datasql1 !=null">
                and ${condition.datasql1}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="1==1" >
                and state='1'
            </if>
        </trim>
        ) z
        LEFT JOIN t_finance_approvalprice t1 on z.supplierid=t1.supplierid
        GROUP BY z.supplierid
        <if test="condition.isflag == null">
            <include refid="common.Page_limit"/>
        </if>
    </select>
    <select id="getStatisticsListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        select z.supplierid,z.supplierdeptid,sum(z.lastamount) as lastAmount,sum(z.realatamount) as realatamount,t1.price as approvalAmount,(sum(z.realatamount) - sum(z.lastamount)) as settleamount
        from(
        SELECT supplierid,supplierdeptid,subjectexpenses as lastamount,0 as realatamount
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        UNION ALL
        select supplierid,supplierdeptid,0 as lastamount,
        (advanceamount+stockamount+receivableamount+actingmatamount+payableamount) as realatamount
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="condition.datasql1 !=null">
                and ${condition.datasql1}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="1==1" >
                and state='1'
            </if>
        </trim>
        ) z
        LEFT JOIN t_finance_approvalprice t1 on z.supplierid=t1.supplierid
        GROUP BY z.supplierid
        ) y
    </select>
    <select id="getStatisticsListSumData" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">
        select sum(y.lastAmount) as lastAmount,sum(y.approvalAmount) as approvalAmount,sum(y.realatamount) as realatamount,sum(y.settleamount) as settleamount
        from(
        select z.supplierid,z.supplierdeptid,sum(z.lastamount) as lastAmount,sum(z.realatamount) as realatamount,t1.price as approvalAmount,(sum(z.realatamount) - sum(z.lastamount)) as settleamount
        from(
        SELECT supplierid,supplierdeptid,subjectexpenses as lastamount,0 as realatamount
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        UNION ALL
        select supplierid,supplierdeptid,0 as lastamount,
        (advanceamount+stockamount+receivableamount+actingmatamount+payableamount) as realatamount
        FROM t_js_fundinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="condition.datasql1 !=null">
                and ${condition.datasql1}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="1==1" >
                and state='1'
            </if>
        </trim>
        ) z
        LEFT JOIN t_finance_approvalprice t1 on z.supplierid=t1.supplierid
        GROUP BY z.supplierid
        ) y
    </select>
    <select id="getStatisticsSumBySupplierid" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        <include refid="common.Page_limit"/>
    </select>
    <select id="getStatisticsAllSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
        </trim>
    </select>
    <select id="getStatisticsQuerySumBySubjectid" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid =#{condition.subjectid}
            </if>
        </trim>
    </select>
    <select id="getStatisticsAllSumBySubejctid" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        SELECT sum(subjectexpenses) as subjectexpenses
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid =#{condition.subjectid}
            </if>
        </trim>
    </select>
    <select id="getStatisticsDetailList" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.ExpensesEntering">
        SELECT id, supplierid, businessdate, remark, suppliername, supplierdeptid, subjectid, subjectname, adduserid, addusername, subjectexpenses,ADDTIME
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        order by businessdate
        <include refid="common.Page_limit"/>
    </select>
    <select id="getStatisticsDetailCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        SELECT id, supplierid, businessdate, remark, suppliername, supplierdeptid, subjectid, subjectname, adduserid, addusername, subjectexpenses,ADDTIME
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        order by businessdate
        )z
    </select>

    <!-- 统计报表 -->
    <select id="getStatisticslist" parameterType="com.hd.agent.common.util.PageMap" resultMap="ExpensesEnteringResultMap">
        SELECT id, supplierid, businessdate, remark, suppliername, supplierdeptid, subjectid, subjectname,
        subjectexpenses, adduserid, addusername, SUM(subjectexpenses) AS accountprice,businessdate
        FROM
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid in
                <foreach collection="condition.array" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= DATE_ADD(STR_TO_DATE(#{condition.endtime},'%Y-%m-%d'),INTERVAL 1 DAY)]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid =#{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        GROUP BY subjectid
        <include refid="common.Page_limit" />
    </select>
    <!-- 统计报表分页数量 -->
    <select id="getStatisticsCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) FROM (
        select supplierid
        from
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.subjectid != null" >
                and subjectid in
                <foreach collection="condition.array" item="item" open="(" separator="," close=")">
                    #{item}
                </foreach>
            </if>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= DATE_ADD(STR_TO_DATE(#{condition.endtime},'%Y-%m-%d'),INTERVAL 1 DAY)]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid =#{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
        group by supplierid
        ) t
    </select>
    <select id="getAmountBySupplierAndSubjectid" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(subjectexpenses) from
        <choose>
            <when test="condition.versionstr == 1">
                t_finance_expensesentering_h
            </when>
            <otherwise>
                t_finance_expensesentering
            </otherwise>
        </choose>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
        </trim>
    </select>

    <!-- 核准金额 -->
    <sql id="ApprovalPrice_Column_List" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                id, supplierid, supplierdeptid, price, atamount
            </when>
        </choose>
    </sql>

    <!-- 获取核准金额列表 -->
    <select id="getApprovalPriceList" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.ApprovalPrice">
        select
        <include refid="ApprovalPrice_Column_List"/>
        from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>

    <!-- 获取核准金额列表数量 -->
    <select id="getApprovalPriceCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
        </trim>
    </select>
    <!-- 新增核准金额 -->
    <insert id="addApprovalPrice" parameterType="com.hd.agent.journalsheet.model.ApprovalPrice">
        <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE" >
            select uuid_short()
        </selectKey>
        insert into t_finance_approvalprice
        <trim prefix="(" suffix=")" suffixOverrides="," >
            id,
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            #{id},
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
        </trim>
    </insert>
    <!-- 修改核准金额 -->
    <update id="editApprovalPrice" parameterType="com.hd.agent.journalsheet.model.ApprovalPrice">
        update t_finance_approvalprice
        <set >
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="price != null" >
                price = #{price},
            </if>
            <if test="atamount != null" >
                atamount = #{atamount},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
        </set>
        where id = #{id}
    </update>
    <!-- 获取核准金额详情 -->
    <select id="getApprovalPriceDetail" parameterType="java.lang.String" resultType="com.hd.agent.journalsheet.model.ApprovalPrice">
        select * from t_finance_approvalprice where id = #{id}
    </select>
    <!-- 删除核准金额 -->
    <delete id="deleteApprovalPrice" parameterType="java.lang.String">
        delete from t_finance_approvalprice
        where id = #{id}
    </delete>
    <!-- 获取未导入供应商列表 -->
    <select id="getSupplierListForApproval" resultType="com.hd.agent.basefiles.model.BuySupplier">
        SELECT * FROM t_base_buy_supplier su
        WHERE (NOT EXISTS (SELECT ap.id FROM t_finance_approvalprice ap WHERE ap.supplierid = su.id))
    </select>
    <select id="getApprovalPriceBySupplierid" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(price) from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
        </trim>
    </select>
    <select id="getRealAtamountBySupplierid" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select atamount from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
        </trim>
    </select>
    <select id="getApprovalPriceByQuery" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(price) from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
    </select>
    <select id="getRealAtamountByQuery" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(atamount) from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
        </trim>
    </select>
    <select id="getTotalApprovalPrice" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(price) from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
        </trim>
    </select>
    <select id="getTotalRealAtamount" parameterType="com.hd.agent.common.util.PageMap" resultType="java.math.BigDecimal">
        select sum(atamount) from t_finance_approvalprice
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
        </trim>
    </select>

    <!-- 代垫录入 -->

    <resultMap id="ReimburseInputResultMap" type="com.hd.agent.journalsheet.model.ReimburseInput" >
        <id column="id" property="id" jdbcType="VARCHAR" />
        <result column="businessdate" property="businessdate" jdbcType="VARCHAR" />
        <result column="planreimbursetime" property="planreimbursetime" jdbcType="VARCHAR" />
        <result column="remark" property="remark" jdbcType="VARCHAR" />
        <result column="supplierid" property="supplierid" jdbcType="VARCHAR" />
        <result column="supplierdeptid" property="supplierdeptid" jdbcType="VARCHAR" />
        <result column="brandid" property="brandid" jdbcType="VARCHAR" />
        <result column="subjectid" property="subjectid" jdbcType="VARCHAR" />
        <result column="reimbursetype" property="reimbursetype" jdbcType="CHAR" />
        <result column="planreimbursetype" property="planreimbursetype" jdbcType="CHAR" />
        <result column="planamount" property="planamount" jdbcType="DECIMAL" />
        <result column="takebackamount" property="takebackamount" jdbcType="DECIMAL" />
        <result column="untakebackamount" property="untakebackamount" jdbcType="DECIMAL" />
        <result column="actingmatamount" property="actingmatamount" jdbcType="DECIMAL" />
        <result column="surplusamount" property="surplusamount" jdbcType="DECIMAL" />
        <result column="adduserid" property="adduserid" jdbcType="VARCHAR" />
        <result column="addusername" property="addusername" jdbcType="VARCHAR" />
        <result column="addtime" property="addtime" jdbcType="TIMESTAMP" />
    </resultMap>
    <sql id="ReimburseInput_Column_List" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                id, businessdate, remark, supplierid, supplierdeptid, brandid, subjectid, planreimbursetime,
                reimbursetype, planamount, takebackamount, untakebackamount, actingmatamount, surplusamount, planreimbursetype,
                adduserid, addusername, addtime
            </when>
        </choose>
    </sql>
    <!-- 获取代垫录入列表分页 -->
    <select id="getReimburseInputListPage" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        select
        <include refid="ReimburseInput_Column_List"/>
        from t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
        <include refid="common.Page_limit" />
    </select>
    <!-- 获取代垫录入列表分页数量 -->
    <select id="getReimburseInputListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
    </select>
    <!-- 新增代垫录入 -->
    <insert id="addReimburseInput" parameterType="com.hd.agent.journalsheet.model.ReimburseInput">
        <selectKey resultType="java.lang.String" keyProperty="id" order="BEFORE" >
            select uuid_short()
        </selectKey>
        insert into t_js_reimburseinput
        <trim prefix="(" suffix=")" suffixOverrides="," >
            id,
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
            <if test="brandid != null" >
                brandid,
            </if>
            <if test="subjectid != null" >
                subjectid,
            </if>
            <if test="reimbursetype != null" >
                reimbursetype,
            </if>
            <if test="planreimbursetype != null" >
                planreimbursetype,
            </if>
            <if test="planamount != null" >
                planamount,
            </if>
            <if test="planreimbursetime != null" >
                planreimbursetime,
            </if>
            <if test="takebackamount != null" >
                takebackamount,
            </if>
            <if test="untakebackamount != null" >
                untakebackamount,
            </if>
            <if test="actingmatamount != null" >
                actingmatamount,
            </if>
            <if test="surplusamount != null" >
                surplusamount,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1 == 1" >
                addtime,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            #{id},
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
            <if test="brandid != null" >
                #{brandid},
            </if>
            <if test="subjectid != null" >
                #{subjectid},
            </if>
            <if test="reimbursetype != null" >
                #{reimbursetype},
            </if>
            <if test="planreimbursetype != null" >
                #{planreimbursetype},
            </if>
            <if test="planamount != null" >
                #{planamount},
            </if>
            <if test="planreimbursetime != null" >
                #{planreimbursetime},
            </if>
            <if test="takebackamount != null" >
                #{takebackamount},
            </if>
            <if test="untakebackamount != null" >
                #{untakebackamount},
            </if>
            <if test="actingmatamount != null" >
                #{actingmatamount},
            </if>
            <if test="surplusamount != null" >
                #{surplusamount},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <if test="1 == 1" >
                now(),
            </if>
        </trim>
    </insert>
    <!-- 修改代垫录入 -->
    <update id="editReimburseInput" parameterType="com.hd.agent.journalsheet.model.ReimburseInput">
        update t_js_reimburseinput
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="brandid != null" >
                brandid = #{brandid},
            </if>
            <if test="subjectid != null" >
                subjectid = #{subjectid},
            </if>
            <if test="reimbursetype != null" >
                reimbursetype = #{reimbursetype},
            </if>
            <if test="planreimbursetype != null" >
                planreimbursetype = #{planreimbursetype},
            </if>
            <if test="planamount != null" >
                planamount = #{planamount},
            </if>
            <if test="planreimbursetime != null" >
                planreimbursetime = #{planreimbursetime},
            </if>
            <if test="takebackamount != null" >
                takebackamount = #{takebackamount},
            </if>
            <if test="untakebackamount != null" >
                untakebackamount = #{untakebackamount},
            </if>
            <if test="actingmatamount != null" >
                actingmatamount = #{actingmatamount},
            </if>
            <if test="surplusamount != null" >
                surplusamount = #{surplusamount},
            </if>
        </set>
        where id = #{id}
    </update>
    <!-- 删除代垫录入 -->
    <delete id="deleteReimburseInput" parameterType="java.lang.String">
        delete from t_js_reimburseinput
        where id = #{id}
    </delete>
    <!-- 获取代垫录入详情 -->
    <select id="getReimberseInputDetail" parameterType="java.util.Map" resultMap="ReimburseInputResultMap">
        select
        <include refid="ReimburseInput_Column_List"/>
        from t_js_reimburseinput
        where id = #{id}
    </select>
    <!-- 根据查询条件获取金额合计 -->
    <select id="getReimberseInputSums" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        SELECT SUM(planamount) AS planamount, SUM(takebackamount) AS takebackamount, SUM(actingmatamount) AS actingmatamount
        FROM t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
    </select>
    <!-- 代垫统计报表 -->
    <!-- 第一层 获取所有供应商列表 -->
    <select id="getRISSheetAllSupplier" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        SELECT  supplierid, supplierdeptid,SUM(planamount) AS planamount,SUM(takebackamount) AS takebackamount,
        SUM(untakebackamount) AS untakebackamount,SUM(actingmatamount) AS actingmatamount,SUM(surplusamount) AS surplusamount
        FROM t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
        GROUP BY supplierid
        <if test="condition.isflag == null">
            <include refid="common.Page_limit"/>
        </if>
    </select>
    <!-- 第一层 获取所有供应商列表数量 -->
    <select id="getRISSheetAllSupplierCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from (
        SELECT  supplierid, supplierdeptid,SUM(planamount) AS planamount,SUM(takebackamount) AS takebackamount,
        SUM(untakebackamount) AS untakebackamount,SUM(actingmatamount) AS actingmatamount,SUM(surplusamount) AS surplusamount
        FROM t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
        GROUP BY supplierid
        )t
    </select>
    <!-- 第一层 获取总金额 -->
    <select id="getRISSheetAllSum" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        SELECT SUM(planamount) AS planamount, SUM(takebackamount) AS takebackamount, SUM(actingmatamount) AS actingmatamount
        FROM t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
        </trim>
    </select>

    <!-- 第二层 -->
    <select id="getRISSheetAllBrandBySupplierid" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        SELECT DISTINCT brandid from t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
    </select>
    <!-- 代垫录入指定供应商下所指定品牌下的所有科目 -->
    <select id="getRISSheetAllBrandBySupplieridAndBrandid" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        SELECT DISTINCT subjectid from t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
    </select>
    <!-- 根据指定供应商、品牌、科目条件，获取代垫明细 -->
    <select id="getRISSheetDetailList" parameterType="com.hd.agent.common.util.PageMap" resultMap="ReimburseInputResultMap">
        select id, businessdate, remark, supplierid, supplierdeptid, brandid, subjectid, planreimbursetime,
        reimbursetype, planamount, takebackamount, actingmatamount, planreimbursetype,
        adduserid, addusername, addtime
        from t_js_reimburseinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.begintime != null">
                and businessdate >= STR_TO_DATE(#{condition.begintime},'%Y-%m-%d')
            </if>
            <if test="condition.endtime != null">
                <![CDATA[and businessdate <= STR_TO_DATE(#{condition.endtime},'%Y-%m-%d')]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.brandid != null" >
                and brandid = #{condition.brandid}
            </if>
        </trim>
        order by businessdate
    </select>

    <!-- 垫付录入 -->
    <sql id="MatcostsInput_Column_List" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                <include refid="MatcostsInput_BaseColumn"/>
            </when>
        </choose>
    </sql>
    <sql id="MatcostsInput_BaseColumn">
        id, businessdate, oaid,bankid, remark, supplierid, supplierdeptid, customerid, subjectid, factoryamount,
        htcompdiscount, htpayamount, branchaccount, reimbursetype,
        reimburseamount, actingmatamount,  adduserid, addusername, addtime,brandid,iswriteoff,
        writeoffdate,writeoffer,writeoffername,sourcefrome,writeoffamount,billtype,remainderamount,
        expense,hcflag,hcreferid,hcrefcount,paydate,takebackdate,printtimes,shprinttimes,
	    unitid,unitnum,taxprice,shsubjectid,transactorid,duefromdate,vouchertimes
    </sql>

    <sql id="MatcostsInput_Column_List_Prefix" >
        <choose>
            <when test="cols!=null">
                <include refid="common.Page_Column"/>
            </when>
            <when test="cols==null">
                <include refid="MatcostsInput_BaseColumn_Prefix"/>
            </when>
        </choose>
    </sql>
    <sql id="MatcostsInput_BaseColumn_Prefix">
        t.id,t.businessdate,t.oaid,t.bankid,t.remark,t.supplierid,t.supplierdeptid,t.customerid,t.subjectid,t.factoryamount,
        t.htcompdiscount,t.htpayamount,t.branchaccount,t.reimbursetype,
        t.reimburseamount,t.actingmatamount,t.adduserid,t.addusername,t.addtime,t.brandid,t.iswriteoff,
        t.writeoffdate,t.writeoffer,t.writeoffername,t.sourcefrome,t.writeoffamount,t.billtype,t.remainderamount,
        t.expense,t.hcflag,t.hcreferid,t.hcrefcount,t.paydate,t.takebackdate,t.printtimes,t.shprinttimes,
        t.unitid,t.unitnum,t.taxprice,t.shsubjectid,t.transactorid,t.duefromdate,t.vouchertimes
    </sql>

    <!-- 获取代垫录入列表分页 -->
    <sql id="MatcostsInputPageList_Where_Clause">
        <if test="1==1">
            and t.billtype='1'
        </if>
        <if test="condition.begintime != null">
            <![CDATA[and t.businessdate >= #{condition.begintime}]]>
        </if>
        <if test="condition.endtime != null">
            <![CDATA[and t.businessdate <= #{condition.endtime}]]>
        </if>
        <if test="condition.businessyearmonth != null">
            <![CDATA[and t.businessdate like '${condition.businessyearmonth}%']]>
        </if>
        <if test="condition.writeoffbegintime != null">
            <![CDATA[ and t.writeoffdate >=  #{condition.writeoffbegintime}  ]]>
        </if>
        <if test="condition.writeoffendtime != null">
            <![CDATA[ and t.writeoffdate <=  #{condition.writeoffendtime}  ]]>
        </if>
        <if test="condition.paydate1 != null">
            <![CDATA[and t.paydate >= #{condition.paydate1}]]>
        </if>
        <if test="condition.paydate2 != null">
            <![CDATA[and t.paydate <= #{condition.paydate2}]]>
        </if>
        <if test="condition.takebackdate1 != null">
            <![CDATA[and t.takebackdate >= #{condition.takebackdate1}]]>
        </if>
        <if test="condition.takebackdate2 != null">
            <![CDATA[and t.takebackdate <= #{condition.takebackdate2}]]>
        </if>
        <if test="condition.subjectid != null" >
            and find_in_set(t.subjectid,#{condition.subjectid})
        </if>
        <if test="condition.brandid != null" >
            and find_in_set(t.brandid,#{condition.brandid})
        </if>
        <if test="condition.supplierid != null" >
            and t.supplierid = #{condition.supplierid}
        </if>
        <if test="condition.customerid != null" >
            and t.customerid = #{condition.customerid}
        </if>
        <if test="condition.supplierdeptid != null" >
            and t.supplierdeptid like '${condition.supplierdeptid}%'
        </if>
        <if test="condition.id != null" >
            and t.id=#{condition.id}
        </if>
        <if test="condition.idarrs != null" >
            and FIND_IN_SET(t.id,#{condition.idarrs})
        </if>
        <if test="condition.oaidarr != null" >
            and FIND_IN_SET(t.oaid,#{condition.oaidarr})
        </if>
        <choose>
            <when test="condition.ishcflag == 1">
                and (t.hcflag = '1' or t.hcflag = '2')
            </when>
            <when test="condition.ishcflag == 2">
                and (t.hcflag='0' or length(t.hcflag)=0)
            </when>
        </choose>
        <if test="condition.hcflag != null" >
            and t.hcflag = #{condition.hcflag}
        </if>
        <if test="condition.iswriteoff != null" >
            and t.iswriteoff = #{condition.iswriteoff}
        </if>
        <if test="condition.hcreferid != null" >
            and t.hcreferid like concat('%',#{condition.hcreferid},'%')
        </if>
        <if test="condition.showCanWriteoff != null" >
            <![CDATA[and t.iswriteoff <> '1' and (hcflag='0' or length(hcflag)=0 ) ]]>
        </if>
        <choose>
            <when test="condition.writeoffstatus == 1">
                and t.iswriteoff = '1'
            </when>
            <when test="condition.writeoffstatus == 2">
                <![CDATA[and t.iswriteoff <> '1' and t.iswriteoff <> '2']]>
            </when>
            <when test="condition.writeoffstatus == 3">
                <![CDATA[and t.iswriteoff = '2']]>
            </when>
            <when test="condition.writeoffstatus == 4">
                <![CDATA[and (t.iswriteoff = '1' or t.iswriteoff='2')]]>
            </when>
        </choose>
        <if test="condition.writeoffdateyearmonth != null">
            <![CDATA[and t.writeoffdate like '${condition.writeoffdateyearmonth}%']]>
        </if>
	    <if test="condition.printsign != null and condition.queryprinttimes != null">
      		<choose>
      			<when test="condition.printsign == 1">
      				<![CDATA[and t.printtimes = #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 2">
      				<![CDATA[and t.printtimes < #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 3">
      				<![CDATA[and t.printtimes <= #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 4">
      				<![CDATA[and t.printtimes > #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 5">
      				<![CDATA[and t.printtimes >= #{condition.queryprinttimes} ]]>
      			</when>
      		</choose>
      </if>
        <if test="condition.transactorid != null" >
            and t.transactorid = #{condition.transactorid}
        </if>
    </sql>
    <select id="getMatcostsInputPageList" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        SELECT
        * FROM (
        select
        <include refid="MatcostsInput_Column_List_Prefix"/>
        <if test="condition.dyncReimburseColumn !=null">
            ${condition.dyncReimburseColumn}
        </if>
        from t_js_matcostsinput t
        <if test="condition.customersort != null">
            left join t_base_sales_customer t5 on t.customerid = t5.id
        </if>
        <trim prefix="where" prefixOverrides="and|or">
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <include refid="MatcostsInputPageList_Where_Clause"/>
            <if test="condition.customersort != null" >
                and t5.customersort = #{condition.customersort}
            </if>
        </trim>
        ) t
        <if test="condition.isPageflag !='true'">
            <include refid="common.Page_limit" />
        </if>
        <if test="condition.isPageflag =='true'">
            <choose>
                <when test="orderSql !=null and orderSql!=''">
                    order by ${orderSql}
                </when>
                <otherwise>
                    <if test="condition.sort !=null and condition.order !=null">
                        order by ${condition.sort} ${condition.order}
                    </if>
                </otherwise>
            </choose>
        </if>
    </select>
    <!-- 获取代垫录入列表分页数量 -->
    <select id="getMatcostsInputListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from t_js_matcostsinput t
        <if test="condition.customersort != null">
            left join t_base_sales_customer t5 on t.customerid = t5.id
        </if>
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <include refid="MatcostsInputPageList_Where_Clause" />
            <if test="condition.customersort != null" >
                and t5.customersort = #{condition.customersort}
            </if>
        </trim>
    </select>
    <!-- 根据供应商编码获取代垫金额合计 -->
    <select id="getMatcostsInputActingmatamountSum" parameterType="java.lang.String" resultType="java.math.BigDecimal">
        select sum(actingmatamount) as actingmatamount from t_js_matcostsinput
        where supplierid = #{supplierid}
    </select>
    <select id="getMatcostsInputList" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_Column_List"/>
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="condition.businessdate != null">
                <![CDATA[ and businessdate =  #{condition.businessdate}  ]]>
            </if>
            <if test="condition.subjectid != null" >
                and subjectid = #{condition.subjectid}
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.customerid != null" >
                and customerid = #{condition.customerid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.idarrs != null" >
                and FIND_IN_SET(id,#{condition.idarrs})
            </if>
            <if test="condition.oaidarr != null" >
                and FIND_IN_SET(oaid,#{condition.oaidarr})
            </if>
            <if test="condition.iswriteoff != null" >
                and iswriteoff = #{condition.iswriteoff}
            </if>
            <if test="condition.showCanWriteoff != null" >
                <![CDATA[and iswriteoff <> '1'  and (hcflag='0' or length(hcflag)=0 ) ]]>
            </if>
            <if test="condition.reimbursetype != null" >
                and reimbursetype = #{condition.reimbursetype}
            </if>
            <choose>
                <when test="condition.writeoffstatus == 1">
                    and iswriteoff = '1'
                </when>
                <when test="condition.writeoffstatus == 2">
                    <![CDATA[and iswriteoff <> '1' and iswriteoff <> '2']]>
                </when>
                <when test="condition.writeoffstatus == 3">
                    <![CDATA[and iswriteoff = '2']]>
                </when>
            </choose>
            <if test="condition.hcreferid != null" >
                and hcreferid = #{condition.hcreferid}
            </if>
        </trim>
        <if test="condition.isQueryByOrder != null">
            <choose>
                <when test="condition.orderBySql !=null and condition.orderBySql !=''">
                    order by ${condition.orderBySql}
                </when>
                <otherwise>
                    <if test="condition.orderSort !=null and condition.orderBy !=null">
                        order by ${condition.orderSort} ${condition.orderBy}
                    </if>
                </otherwise>

            </choose>
        </if>
    </select>
    <insert id="insertMatcostsInputALL" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        insert into t_js_matcostsinput
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="1==1" >
                id,
            </if>
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="billtype != null" >
                billtype,
            </if>
            <if test="oaid != null" >
                oaid,
            </if>
            <if test="bankid != null" >
                bankid,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
            <if test="customerid != null" >
                customerid,
            </if>
            <if test="subjectid != null" >
                subjectid,
            </if>
            <if test="factoryamount != null" >
                factoryamount,
            </if>
            <if test="htcompdiscount != null" >
                htcompdiscount,
            </if>
            <if test="htpayamount != null" >
                htpayamount,
            </if>
            <if test="branchaccount != null" >
                branchaccount,
            </if>
            <if test="reimbursetype != null" >
                reimbursetype,
            </if>
            <if test="reimburseamount != null" >
                reimburseamount,
            </if>
            <if test="actingmatamount != null" >
                actingmatamount,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1==1" >
                addtime,
            </if>
            <if test="brandid != null" >
                brandid,
            </if>
            <if test="iswriteoff != null" >
                iswriteoff,
            </if>
            <if test="writeoffdate != null" >
                writeoffdate,
            </if>
            <if test="writeoffer != null" >
                writeoffer,
            </if>
            <if test="writeoffername != null" >
                writeoffername,
            </if>
            <if test="sourcefrome != null" >
                sourcefrome,
            </if>
            <if test="writeoffamount != null" >
                writeoffamount,
            </if>
            <if test="remainderamount != null" >
                remainderamount,
            </if>
            <if test="expense != null" >
                expense,
            </if>
            <if test="hcflag != null" >
                hcflag,
            </if>
            <if test="hcreferid != null" >
                hcreferid,
            </if>
            <if test="hcrefcount != null" >
                hcrefcount,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="paydate != null" >
                paydate,
            </if>
            <if test="takebackdate != null" >
                takebackdate,
            </if>
	      	<if test="unitid != null" >
	        	unitid,
	      	</if>
	      	<if test="unitnum != null" >
	        	unitnum,
	      	</if>
	      	<if test="taxprice != null" >
	        	taxprice,
	      	</if>
	      	<if test="shsubjectid != null" >
	        	shsubjectid,
	      	</if>
            <if test="transactorid != null" >
                transactorid,
            </if>
            <if test="duefromdate != null" >
                duefromdate,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <choose>
                <when test="id != null">
                    #{id},
                </when>
                <otherwise>
                    UUID_SHORT(),
                </otherwise>
            </choose>
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="billtype != null" >
                #{billtype},
            </if>
            <if test="oaid != null" >
                #{oaid},
            </if>
            <if test="bankid != null" >
                #{bankid},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
            <if test="customerid != null" >
                #{customerid},
            </if>
            <if test="subjectid != null" >
                #{subjectid},
            </if>
            <if test="factoryamount != null" >
                #{factoryamount},
            </if>
            <if test="htcompdiscount != null" >
                #{htcompdiscount},
            </if>
            <if test="htpayamount != null" >
                #{htpayamount},
            </if>
            <if test="branchaccount != null" >
                #{branchaccount},
            </if>
            <if test="reimbursetype != null" >
                #{reimbursetype},
            </if>
            <if test="reimburseamount != null" >
                #{reimburseamount},
            </if>
            <if test="actingmatamount != null" >
                #{actingmatamount},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <choose>
                <when test="addtime != null">#{addtime},</when>
                <otherwise>now(),</otherwise>
            </choose>
            <if test="brandid != null" >
                #{brandid},
            </if>
            <if test="iswriteoff != null" >
                #{iswriteoff},
            </if>
            <if test="writeoffdate != null" >
                #{writeoffdate},
            </if>
            <if test="writeoffer != null" >
                #{writeoffer},
            </if>
            <if test="writeoffername != null" >
                #{writeoffername},
            </if>
            <if test="sourcefrome != null" >
                #{sourcefrome},
            </if>
            <if test="writeoffamount != null" >
                #{writeoffamount},
            </if>
            <if test="remainderamount != null" >
                #{remainderamount},
            </if>
            <if test="expense != null" >
                #{expense},
            </if>
            <if test="hcflag != null" >
                #{hcflag},
            </if>
            <if test="hcreferid != null" >
                #{hcreferid},
            </if>
            <if test="hcrefcount != null" >
                #{hcrefcount},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="paydate != null" >
                #{paydate},
            </if>
            <if test="takebackdate != null" >
                #{takebackdate},
            </if>
	      	<if test="unitid != null" >
	        	#{unitid},
	      	</if>
	      	<if test="unitnum != null" >
	        	#{unitnum},
	      	</if>
	      	<if test="taxprice != null" >
	        	#{taxprice},
	      	</if>
	      	<if test="shsubjectid != null" >
	        	#{shsubjectid},
	      	</if>
            <if test="transactorid != null" >
                #{transactorid},
            </if>
            <if test="duefromdate != null" >
                #{duefromdate},
            </if>
        </trim>
    </insert>
    <insert id="insertMatcostsInput" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        insert into t_js_matcostsinput
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="1==1" >
                id,
            </if>
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="oaid != null" >
                oaid,
            </if>
            <if test="bankid != null" >
                bankid,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
            <if test="customerid != null" >
                customerid,
            </if>
            <if test="subjectid != null" >
                subjectid,
            </if>
            <if test="factoryamount != null" >
                factoryamount,
            </if>
            <if test="htcompdiscount != null" >
                htcompdiscount,
            </if>
            <if test="htpayamount != null" >
                htpayamount,
            </if>
            <if test="branchaccount != null" >
                branchaccount,
            </if>
            <if test="reimbursetype != null" >
                reimbursetype,
            </if>
            <if test="reimburseamount != null" >
                reimburseamount,
            </if>
            <if test="actingmatamount != null" >
                actingmatamount,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1==1" >
                addtime,
            </if>
            <if test="brandid != null" >
                brandid,
            </if>
            <if test="sourcefrome != null" >
                sourcefrome,
            </if>
            <if test="remainderamount !=null">
                remainderamount,
            </if>
            <if test="expense !=null">
                expense,
            </if>
            <if test="hcflag !=null">
                hcflag,
            </if>
            <if test="hcreferid !=null">
                hcreferid,
            </if>
            <if test="paydate != null" >
                paydate,
            </if>
            <if test="takebackdate != null" >
                takebackdate,
            </if>
            <if test="transactorid != null" >
                transactorid,
            </if>
            <if test="duefromdate != null" >
                duefromdate,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <choose>
                <when test="id != null">
                    #{id},
                </when>
                <otherwise>
                    UUID_SHORT(),
                </otherwise>
            </choose>
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="oaid != null" >
                #{oaid},
            </if>
            <if test="bankid != null" >
                #{bankid},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
            <if test="customerid != null" >
                #{customerid},
            </if>
            <if test="subjectid != null" >
                #{subjectid},
            </if>
            <if test="factoryamount != null" >
                #{factoryamount},
            </if>
            <if test="htcompdiscount != null" >
                #{htcompdiscount},
            </if>
            <if test="htpayamount != null" >
                #{htpayamount},
            </if>
            <if test="branchaccount != null" >
                #{branchaccount},
            </if>
            <if test="reimbursetype != null" >
                #{reimbursetype},
            </if>
            <if test="reimburseamount != null" >
                #{reimburseamount},
            </if>
            <if test="actingmatamount != null" >
                #{actingmatamount},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <choose>
                <when test="addtime != null">#{addtime},</when>
                <otherwise>now(),</otherwise>
            </choose>
            <if test="brandid != null" >
                #{brandid},
            </if>
            <if test="sourcefrome != null" >
                #{sourcefrome},
            </if>
            <if test="remainderamount !=null">
                #{remainderamount},
            </if>
            <if test="expense !=null">
                #{expense},
            </if>
            <if test="hcflag !=null">
                #{hcflag},
            </if>
            <if test="hcreferid !=null">
                #{hcreferid},
            </if>
            <if test="paydate != null" >
                #{paydate},
            </if>
            <if test="takebackdate != null" >
                #{takebackdate},
            </if>
            <if test="transactorid != null" >
                #{transactorid},
            </if>
            <if test="duefromdate != null" >
                #{duefromdate},
            </if>
        </trim>
    </insert>
    <update id="updateMatcostsInput" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        update t_js_matcostsinput
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="oaid != null" >
                oaid = #{oaid},
            </if>
            <if test="bankid != null" >
                bankid = #{bankid},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="customerid != null" >
                customerid = #{customerid},
            </if>
            <if test="subjectid != null" >
                subjectid = #{subjectid},
            </if>
            <if test="factoryamount != null" >
                factoryamount = #{factoryamount},
            </if>
            <if test="htcompdiscount != null" >
                htcompdiscount = #{htcompdiscount},
            </if>
            <if test="htpayamount != null" >
                htpayamount = #{htpayamount},
            </if>
            <if test="branchaccount != null" >
                branchaccount = #{branchaccount},
            </if>
            <if test="reimbursetype != null" >
                reimbursetype = #{reimbursetype},
            </if>
            <if test="reimburseamount != null" >
                reimburseamount = #{reimburseamount},
            </if>
            <if test="actingmatamount != null" >
                actingmatamount = #{actingmatamount},
            </if>
            <if test="brandid != null" >
                brandid = #{brandid},
            </if>
            <if test="remainderamount !=null">
                remainderamount=#{remainderamount},
            </if>
            <if test="expense !=null">
                expense=#{expense},
            </if>
            <if test="paydate != null" >
                paydate=#{paydate},
            </if>
            <if test="takebackdate != null" >
                takebackdate=#{takebackdate},
            </if>
            <if test="transactorid != null" >
                transactorid = #{transactorid},
            </if>
            <if test="duefromdate != null" >
                duefromdate = #{duefromdate},
            </if>
        </set>
        where id = #{id}
    </update>
    <update id="updateMatcostsInputHCReferCount" parameterType="java.lang.String" >
        update t_js_matcostsinput
        set
        <choose>
            <when test="countype==1"><![CDATA[hcrefcount=if(hcrefcount<0,0,hcrefcount+1)]]></when>
            <when test="countype==2"><![CDATA[hcrefcount=if(hcrefcount<=0,0,hcrefcount-1)]]></when>
        </choose>
        where id=#{id}
    </update>
    <!-- 删除代垫录入 -->
    <delete id="deleteMatcostsInput" parameterType="java.lang.String">
        delete from t_js_matcostsinput
        where id = #{id}
    </delete>
    <delete id="deleteMatcostsInputByAuth" parameterType="java.util.Map">
        delete from t_js_matcostsinput
        <trim  prefix="where" prefixOverrides="and|or" >
            <choose>
                <when test="id != null">
                    and id = #{id}
                </when>
                <otherwise>and 1=2 </otherwise>
            </choose>
            <if test="dataAuthSql != null">
                and ${dataAuthSql}
            </if>
            <choose>
                <when test="deletebilltype==1">
                    <![CDATA[ and iswriteoff <> '1' and billtype='1' ]]>
                </when>
                <when test="deletebilltype==2">
                    <![CDATA[ and iswriteoff <> '1' and iswriteoff<>'2'   and billtype='2']]>
                </when>
            </choose>
            <if test="deletesource==1">
                and (sourcefrome='0' or sourcefrome='1' or length(sourcefrome)=0)
            </if>
        </trim>
    </delete>
    <!-- 获取代垫录入详情 -->
    <select id="getMatcostsInputDetail" parameterType="java.util.Map" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_BaseColumn"/>
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and id = #{id}
            </if>
            <if test="dataSql != null">
                and ${dataSql}
            </if>
            <if test="billtype != null">
                and billtype=#{billtype}
            </if>
        </trim>
    </select>
    <select id="getMatcostsInput" parameterType="String" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_BaseColumn"/>
        from t_js_matcostsinput
        where id = #{id}
    </select>
    <select id="getMatcostsInputByMap" parameterType="map" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_BaseColumn"/>
        from t_js_matcostsinput
        where
        <trim prefixOverrides="and|or" >
            <if test="hcreferid != null">
                and hcreferid = #{hcreferid}
            </if>
            <if test="hcflag != null">
                and hcflag=#{hcflag}
            </if>
            <if test="sourcefrome != null">
                and sourcefrome=#{sourcefrome}
            </if>
        </trim>
    </select>
    <select id="getReimberseInputByIds" resultType="java.util.Map">
        select id,businessdate,supplierid,actingmatamount as taxamount from t_js_matcostsinput
        where  id in
        <if test="list != null">
            <foreach collection="list" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        <if test="list == null">
            1>2
        </if>
    </select>
    <!-- 根据查询条件获取金额合计 -->
    <select id="getMatcostsInputSums" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        <choose>
            <when test="condition.dyncReimburseSumColumn !=null and condition.dyncReimburseColumn != null">
                SELECT SUM(factoryamount) AS factoryamount,  SUM(htcompdiscount) AS htcompdiscount,
                SUM(htpayamount) AS htpayamount, SUM(branchaccount) AS branchaccount, SUM(reimburseamount) AS reimburseamount,
                SUM(actingmatamount) AS actingmatamount,SUM(writeoffamount) AS writeoffamount,sum(remainderamount) as remainderamount
                ,sum(expense) as expense ${condition.dyncReimburseSumColumn}
                FROM (
                SELECT
                t.factoryamount,t.htcompdiscount,t.htpayamount,t.branchaccount,t.reimburseamount,
                if(t.iswriteoff='1',t.factoryamount-t.writeoffamount,t.actingmatamount) as actingmatamount,t.writeoffamount,
                t.remainderamount,t.expense ${condition.dyncReimburseColumn}
                FROM t_js_matcostsinput t
                <if test="condition.customersort != null">
                    left join t_base_sales_customer t5 on t.customerid = t5.id
                </if>
                <trim prefix="where" prefixOverrides="and|or" >
                    <include refid="common.Page_dataSql"/>
                    <include refid="common.Page_querySql"/>
                    <include refid="MatcostsInputPageList_Where_Clause"/>
                    <if test="condition.customersort != null" >
                        and t5.customersort = #{condition.customersort}
                    </if>
                </trim>
                ) t
            </when>
            <otherwise>
                SELECT SUM(t.factoryamount) AS factoryamount,  SUM(t.htcompdiscount) AS htcompdiscount,
                SUM(t.htpayamount) AS htpayamount, SUM(t.branchaccount) AS branchaccount, SUM(t.reimburseamount) AS reimburseamount,
                SUM(if(t.iswriteoff='1',t.factoryamount-t.writeoffamount,t.actingmatamount)) AS actingmatamount,
                SUM(t.writeoffamount) AS writeoffamount,sum(t.remainderamount) as remainderamount,sum(t.expense) as expense
                FROM t_js_matcostsinput t
                <if test="condition.customersort != null">
                    left join t_base_sales_customer t5 on t.customerid = t5.id
                </if>
                <trim prefix="where" prefixOverrides="and|or" >
                    <include refid="common.Page_dataSql"/>
                    <include refid="common.Page_querySql"/>
                    <include refid="MatcostsInputPageList_Where_Clause"/>
                    <if test="condition.customersort != null" >
                        and t5.customersort = #{condition.customersort}
                    </if>
                </trim>
            </otherwise>
        </choose>
    </select>
    <sql id="matcostsReportData_sql">
        select z.supplierid,z.supplierdeptid,z.subjectid,z.customerid,z.brandid, sum(z.beginamount) as beginamount,
        sum(z.factoryamount) as factoryamount,sum(z.htcompdiscount) as htcompdiscount,sum(z.htpayamount) as htpayamount,
        sum(z.branchaccount) as branchaccount,sum(z.reimburseamount) as reimburseamount,sum(z.actingmatamount) as actingmatamount,
        (sum(z.beginamount)+sum(z.factoryamount)-sum(z.reimburseamount)) as endamount
        <if test="condition.dyncMatSumColumn!=null and condition.dyncMatSumColumn!=''">
            ${condition.dyncMatSumColumn}
        </if>
        from (
        select t.supplierid,t.supplierdeptid,t.subjectid,t.customerid,t.brandid,0 as beginamount,
        t.factoryamount,t.htcompdiscount as htcompdiscount,t.htpayamount as htpayamount,
        t.branchaccount,t.reimburseamount as reimburseamount,t.actingmatamount as actingmatamount
        <if test="condition.dyncMatColumn!=null and condition.dyncMatColumn!=''">
            ${condition.dyncMatColumn}
        </if>
        from t_js_matcostsinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <choose>
                <when test="condition.begindate != null and condition.begindate != ''">
                    <![CDATA[ and  t.businessdate >=  #{condition.begindate} ]]>
                </when>
                <when test="condition.businessdate1 != null and condition.businessdate1 != ''">
                    <![CDATA[ and  t.businessdate >=  #{condition.businessdate1} ]]>
                </when>
            </choose>
            <choose>
                <when test="condition.enddate != null and condition.enddate != ''">
                    <![CDATA[ and  t.businessdate <=  #{condition.enddate} ]]>
                </when>
                <when test="condition.businessdate2 != null and condition.businessdate2 != ''">
                    <![CDATA[ and  t.businessdate <=  #{condition.businessdate2} ]]>
                </when>
            </choose>
            <if test="condition.supplierid != null and condition.supplierid != ''">
                and  t.supplierid =  #{condition.supplierid}
            </if>
            <choose>
                <when test="condition.deptid != null and condition.deptid != ''">
                    and  t.supplierdeptid  like CONCAT(#{condition.deptid},'%')
                </when>
                <when test="condition.supplierdeptid != null and condition.supplierdeptid != ''">
                    and  t.supplierdeptid like CONCAT(#{condition.supplierdeptid},'%')
                </when>
            </choose>
            <if test="condition.writeoffstatus != null and condition.writeoffstatus != ''">
                <choose>
                    <when test="condition.writeoffstatus == 1">
                        and  t.iswriteoff = '1'
                    </when>
                    <otherwise>
                        <![CDATA[ and  t.iswriteoff <> '1' ]]>
                    </otherwise>
                </choose>
            </if>
            <include refid="common.Page_dataSql"/>
        </trim>
        UNION ALL
        select t.supplierid,t.supplierdeptid,t.subjectid,t.customerid,t.brandid,t.actingmatamount as beginamount,
        0 as factoryamount,0 as htcompdiscount,0 as htpayamount,
        0 as branchaccount,0 as reimburseamount,0 as actingmatamount
        <if test="condition.dyncMatBeginColumn!=null and condition.dyncMatBeginColumn!=''">
            ${condition.dyncMatBeginColumn}
        </if>
        from t_js_matcostsinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <choose>
                <when test="condition.begindate != null and condition.begindate != ''">
                    <![CDATA[ and  t.businessdate <  #{condition.begindate} ]]>
                </when>
                <when test="condition.businessdate1 != null and condition.businessdate1 != ''">
                    <![CDATA[ and  t.businessdate < #{condition.businessdate1} ]]>
                </when>
            </choose>
            <if test="condition.supplierid != null and condition.supplierid != ''">
                and  t.supplierid =  #{condition.supplierid}
            </if>
            <choose>
                <when test="condition.deptid != null and condition.deptid != ''">
                    and  t.supplierdeptid  like CONCAT(#{condition.deptid},'%')
                </when>
                <when test="condition.supplierdeptid != null and condition.supplierdeptid != ''">
                    and  t.supplierdeptid like CONCAT(#{condition.supplierdeptid},'%')
                </when>
            </choose>
            <if test="condition.writeoffstatus != null and condition.writeoffstatus != ''">
                <choose>
                    <when test="condition.writeoffstatus == 1">
                        and  t.iswriteoff = '1'
                    </when>
                    <otherwise>
                        <![CDATA[ and  t.iswriteoff <> '1' ]]>
                    </otherwise>
                </choose>
            </if>
            <include refid="common.Page_dataSql"/>
        </trim>
        )z
        <choose>
            <when test="condition.groupcols != null and condition.groupcols  != 'all' ">
                GROUP BY ${condition.groupcols}
            </when>
            <when test="condition.groupcols == null or condition.groupcols == ''">
                GROUP BY z.supplierid,z.supplierdeptid
            </when>
        </choose>
    </sql>
    <select id="showMatcostsReportData" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">
        SELECT
        z.supplierid,z.supplierdeptid,z.subjectid,z.customerid,z.brandid, z.beginamount,
        z.factoryamount,z.htcompdiscount,z.htpayamount,
        z.branchaccount,z.reimburseamount,z.actingmatamount,z.endamount
        <if test="condition.dyncMatOuterColumn!=null and condition.dyncMatOuterColumn!=''">
            ${condition.dyncMatOuterColumn}
        </if>
        FROM (<include refid="matcostsReportData_sql"></include> ) z
        <if test="condition.isPageflag != 'true'  and condition.groupcols  != 'all' " >
            <include refid="common.Page_limit" />
        </if>
    </select>
    <select id="showMatcostsReportDataCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        SELECT COUNT(z.supplierid)
        FROM (<include refid="matcostsReportData_sql"></include> ) z
    </select>
    <select id="showMatcostsReportDataProc" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">
        CALL p_journalsheet_matcost_report("${condition.query_sql}","${dataSql}",#{condition.groupcols},'${condition.begindate}','${condition.enddate}',#{startNum},#{rows},#{condition.isflag},#{condition.orderstr});
    </select>
    <select id="showMatcostsReportDataCountProc" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        CALL p_journalsheet_matcost_report_count("${condition.query_sql}","${dataSql}",#{condition.groupcols},'${condition.begindate}','${condition.enddate}');
    </select>
    <select id="showMatcostsReportDetail" parameterType="java.lang.String" resultType="java.util.Map">
        select t.id,t.businessdate,t.oaid,t.bankid,t.supplierid,t.supplierdeptid,t.subjectid,t.customerid,
        t.factoryamount,t.htcompdiscount,t.htpayamount,
        t.branchaccount,reimbursetype,t.reimburseamount,t.actingmatamount,t.billtype,t.writeoffamount,t.iswriteoff,t.remainderamount,t.expense,t.hcflag,t.remark
        from t_js_matcostsinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="businessdate1 != null and businessdate1 != ''">
                <![CDATA[ and  t.businessdate >=  #{businessdate1}  ]]>
            </if>
            <if test="businessdate2 != null and businessdate2 != ''">
                <![CDATA[ and  t.businessdate <=  #{businessdate2}  ]]>
            </if>
            <if test="supplierid != null" >
                and supplierid = #{supplierid}
            </if>
            <choose>
                <when test="deptid != null and deptid != ''">
                    and  t.supplierdeptid  like CONCAT(#{deptid},'%')
                </when>
                <when test="supplierdeptid != null and supplierdeptid != ''">
                    and  t.supplierdeptid like CONCAT(#{supplierdeptid},'%')
                </when>
            </choose>
                <choose>
                <when test="writeoffstatus == 1">
                    and iswriteoff = '1'
                </when>
                <when test="writeoffstatus == 2">
                    <![CDATA[and iswriteoff <> '1' and iswriteoff <> '2']]>
                </when>
                <when test="writeoffstatus == 3">
                    <![CDATA[and iswriteoff = '2']]>
                </when>
            </choose>
            <if test="hcreferid != null" >
                and hcreferid = #{hcreferid}
            </if>
        </trim>
        order by t.businessdate asc
    </select>
    <select id="getMatcostsBeginAmountBySupplierid" parameterType="java.lang.String" resultType="java.math.BigDecimal">
        select sum(t.actingmatamount) from t_js_matcostsinput t
        where  <![CDATA[ t.businessdate < #{businessdate} ]]> and t.supplierid = #{supplierid}
    </select>
    <select id="getMatcostsBeginAmountByMap" parameterType="java.util.Map" resultType="java.math.BigDecimal">
        select sum(t.actingmatamount) from t_js_matcostsinput t
        where
        <trim prefixOverrides="and|or" >
            <if test="1==1">
                and <![CDATA[ t.businessdate < #{businessdate} ]]>
            </if>
            <if test="supplierid!=null">
                and t.supplierid = #{supplierid}
            </if>
            <choose>
                <when test="deptid != null and deptid != ''">
                    and  t.supplierdeptid  like CONCAT(#{deptid},'%')
                </when>
                <when test="supplierdeptid != null and supplierdeptid != ''">
                    and  t.supplierdeptid like CONCAT(#{supplierdeptid},'%')
                </when>
            </choose>
                <choose>
                <when test="writeoffstatus == 1">
                    and iswriteoff = '1'
                </when>
                <when test="writeoffstatus == 2">
                    <![CDATA[and iswriteoff <> '1' and iswriteoff <> '2']]>
                </when>
                <when test="writeoffstatus == 3">
                    <![CDATA[and iswriteoff = '2']]>
                </when>
            </choose>

        </trim>

    </select>
    <update id="updateMatcostsInputWriteoff" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        update t_js_matcostsinput
        <set >
            <if test="iswriteoff != null" >
                iswriteoff = #{iswriteoff},
            </if>
            <if test="writeoffdate != null" >
                writeoffdate = #{writeoffdate},
            </if>
            <if test="writeoffer != null" >
                writeoffer = #{writeoffer},
            </if>
            <if test="writeoffername != null" >
                writeoffername = #{writeoffername},
            </if>
            <if test="writeoffamount != null" >
                writeoffamount = #{writeoffamount},
            </if>
            <if test="remainderamount != null" >
                remainderamount = #{remainderamount},
            </if>
        </set>
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and id = #{id}
            </if>
            <if test="billtype !=null">
                and billtype=#{billtype}
            </if>
        </trim>
    </update>
    <update id="updateMatcostsInputALL" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        update t_js_matcostsinput
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="billtype != null" >
                billtype = #{billtype},
            </if>
            <if test="oaid != null" >
                oaid = #{oaid},
            </if>
            <if test="bankid != null" >
                bankid = #{bankid},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="customerid != null" >
                customerid = #{customerid},
            </if>
            <if test="subjectid != null" >
                subjectid = #{subjectid},
            </if>
            <if test="factoryamount != null" >
                factoryamount = #{factoryamount},
            </if>
            <if test="htcompdiscount != null" >
                htcompdiscount = #{htcompdiscount},
            </if>
            <if test="htpayamount != null" >
                htpayamount = #{htpayamount},
            </if>
            <if test="branchaccount != null" >
                branchaccount = #{branchaccount},
            </if>
            <if test="reimbursetype != null" >
                reimbursetype = #{reimbursetype},
            </if>
            <if test="reimburseamount != null" >
                reimburseamount = #{reimburseamount},
            </if>
            <if test="actingmatamount != null" >
                actingmatamount = #{actingmatamount},
            </if>
            <if test="adduserid != null" >
                adduserid = #{adduserid},
            </if>
            <if test="addusername != null" >
                addusername = #{addusername},
            </if>
            <if test="addtime != null" >
                addtime = #{addtime},
            </if>
            <if test="brandid != null" >
                brandid = #{brandid},
            </if>
            <if test="iswriteoff != null" >
                iswriteoff = #{iswriteoff},
            </if>
            <if test="writeoffdate != null" >
                writeoffdate = #{writeoffdate},
            </if>
            <if test="writeoffer != null" >
                writeoffer = #{writeoffer},
            </if>
            <if test="writeoffername != null" >
                writeoffername = #{writeoffername},
            </if>
            <if test="sourcefrome != null" >
                sourcefrome = #{sourcefrome},
            </if>
            <if test="writeoffamount != null" >
                writeoffamount = #{writeoffamount},
            </if>
            <if test="remainderamount != null" >
                remainderamount = #{remainderamount},
            </if>
            <if test="expense != null" >
                expense = #{expense},
            </if>
            <if test="hcflag != null" >
                hcflag = #{hcflag},
            </if>
            <if test="hcreferid != null" >
                hcreferid = #{hcreferid},
            </if>
            <if test="hcrefcount != null" >
                hcrefcount = #{hcrefcount},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="transactorid != null" >
                transactorid = #{transactorid},
            </if>
        </set>
        where id = #{id}
    </update>
    <insert id="insertMatcostsReimburse" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        insert into t_js_matcostsinput
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="1==1" >
                id,
            </if>
            <if test="businessdate != null" >
                businessdate,
            </if>
            <if test="oaid != null" >
                oaid,
            </if>
            <if test="bankid != null" >
                bankid,
            </if>
            <if test="remark != null" >
                remark,
            </if>
            <if test="supplierid != null" >
                supplierid,
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid,
            </if>
            <if test="reimbursetype != null" >
                reimbursetype,
            </if>
            <if test="reimburseamount != null" >
                reimburseamount,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1==1" >
                addtime,
            </if>
            <if test="sourcefrome != null" >
                sourcefrome,
            </if>
            <if test="1==1" >
                billtype,
            </if>
            <if test="remainderamount != null" >
                remainderamount,
            </if>
            <if test="actingmatamount != null" >
                actingmatamount,
            </if>
		    <if test="unitid != null" >
		        unitid,
		    </if>
		    <if test="unitnum != null" >
		        unitnum,
		    </if>
		    <if test="taxprice != null" >
		        taxprice,
		    </if>
		    <if test="shsubjectid != null" >
		        shsubjectid,
		    </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <choose>
                <when test="id != null">
                    #{id},
                </when>
                <otherwise>
                    UUID_SHORT(),
                </otherwise>
            </choose>
            <if test="businessdate != null" >
                #{businessdate},
            </if>
            <if test="oaid != null" >
                #{oaid},
            </if>
            <if test="bankid != null" >
                #{bankid},
            </if>
            <if test="remark != null" >
                #{remark},
            </if>
            <if test="supplierid != null" >
                #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                #{supplierdeptid},
            </if>
            <if test="reimbursetype != null" >
                #{reimbursetype},
            </if>
            <if test="reimburseamount != null" >
                #{reimburseamount},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <choose>
                <when test="addtime != null">#{addtime},</when>
                <otherwise>now(),</otherwise>
            </choose>
            <if test="sourcefrome != null" >
                #{sourcefrome},
            </if>
            <if test="1==1" >
                '2',
            </if>
            <if test="remainderamount != null" >
                #{remainderamount},
            </if>
            <if test="actingmatamount != null" >
                #{actingmatamount},
            </if>
	        <if test="unitid != null" >
	            #{unitid},
	        </if>
	        <if test="unitnum != null" >
	            #{unitnum},
	        </if>
	        <if test="taxprice != null" >
	            #{taxprice},
	        </if>
	        <if test="shsubjectid != null" >
	            #{shsubjectid},
	        </if>
        </trim>
    </insert>
    <update id="updateMatcostsReimburse" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" >
        update t_js_matcostsinput
        <set >
            <if test="businessdate != null" >
                businessdate = #{businessdate},
            </if>
            <if test="oaid != null" >
                oaid = #{oaid},
            </if>
            <if test="bankid != null" >
                bankid = #{bankid},
            </if>
            <if test="remark != null" >
                remark = #{remark},
            </if>
            <if test="supplierid != null" >
                supplierid = #{supplierid},
            </if>
            <if test="supplierdeptid != null" >
                supplierdeptid = #{supplierdeptid},
            </if>
            <if test="reimbursetype != null" >
                reimbursetype = #{reimbursetype},
            </if>
            <if test="reimburseamount != null" >
                reimburseamount = #{reimburseamount},
            </if>
            <if test="remainderamount != null" >
                remainderamount = #{remainderamount},
            </if>
            <if test="actingmatamount != null" >
                actingmatamount = #{actingmatamount},
            </if>
	        <if test="unitid != null" >
	        	unitid=#{unitid},
	        </if>
	        <if test="unitnum != null" >
	        	unitnum=#{unitnum},
	        </if>
	        <if test="taxprice != null" >
	        	taxprice=#{taxprice},
	        </if>
	        <if test="shsubjectid != null" >
	        	shsubjectid=#{shsubjectid},
	        </if>
        </set>
        where id = #{id}
    </update>

    <update id="updateMatcostsReimburseType" parameterType="com.hd.agent.journalsheet.model.MatcostsInput">
        update t_js_matcostsinput
        set reimbursetype=#{reimbursetype}
        where id = #{id}
    </update>
    <sql id="MatcostsReimbursePageList_Where_Clause">
        <if test="1==1">
            and billtype='2'
        </if>
        <if test="condition.begintime != null">
            <![CDATA[ and businessdate >=  #{condition.begintime}  ]]>
        </if>
        <if test="condition.endtime != null">
            <![CDATA[ and businessdate <=  #{condition.endtime}  ]]>
        </if>
	    <if test="condition.billtime != null">
	      	<![CDATA[ and DATE_FORMAT(addtime, '%Y-%m-%d') = #{condition.billtime} ]]>
	    </if>
        <if test="condition.subjectid != null" >
            and subjectid = #{condition.subjectid}
        </if>
        <if test="condition.subjectidlike != null" >
            and subjectid  like concat(#{condition.subjectidlike},'%')
        </if>
        <if test="condition.shsubjectid != null" >
            and shsubjectid = #{condition.shsubjectid}
        </if>
        <if test="condition.shsubjectidlike != null" >
            and shsubjectid  like concat(#{condition.shsubjectidlike},'%')
        </if>
        <if test="condition.supplierid != null" >
            and supplierid = #{condition.supplierid}
        </if>
      	<if test="condition.emptysupplier == 1">
      	  	and (length(supplierid)=0 or supplierid is null)
      	</if>
        <if test="condition.customerid != null" >
            and customerid = #{condition.customerid}
        </if>
        <if test="condition.supplierdeptid != null" >
            and supplierdeptid like concat(#{condition.supplierdeptid},'%')
        </if>
        <if test="condition.reimbursetype != null" >
            and reimbursetype = #{condition.reimbursetype}
        </if>
        <if test="condition.id != null" >
            and id=#{condition.id}
        </if>
        <if test="condition.idarrs != null" >
            and FIND_IN_SET(id,#{condition.idarrs})
        </if>
        <if test="condition.oaidarr != null" >
            and FIND_IN_SET(oaid,#{condition.oaidarr})
        </if>
        <if test="condition.iswriteoff != null" >
            and iswriteoff = #{condition.iswriteoff}
        </if>
        <if test="condition.showCanWriteoff != null" >
            <![CDATA[and iswriteoff <> '1']]>
        </if>
        <choose>
            <when test="condition.writeoffstatus == 1">
                and iswriteoff = '1'
            </when>
            <when test="condition.writeoffstatus == 2">
                <![CDATA[and  iswriteoff <> '1' and iswriteoff <> '2']]>
            </when>
            <when test="condition.writeoffstatus == 3">
                <![CDATA[and iswriteoff = '2']]>
            </when>
        </choose>
	    <if test="condition.printsign != null and condition.queryprinttimes != null">
      		<choose>
      			<when test="condition.printsign == 1">
      				<![CDATA[and shprinttimes = #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 2">
      				<![CDATA[and shprinttimes < #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 3">
      				<![CDATA[and shprinttimes <= #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 4">
      				<![CDATA[and shprinttimes > #{condition.queryprinttimes} ]]>
      			</when>
      			<when test="condition.printsign == 5">
      				<![CDATA[and shprinttimes >= #{condition.queryprinttimes} ]]>
      			</when>
      		</choose>
      	</if>
    </sql>
    <select id="getMatcostsReimbursePageList" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        select
        <include refid="MatcostsInput_Column_List"/>
        <if test="condition.dyncReimburseColumn !=null">
            ${condition.dyncReimburseColumn}
        </if>
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <include refid="MatcostsReimbursePageList_Where_Clause"/>
        </trim>
        <if test="condition.isPageflag !='true'">
            <include refid="common.Page_limit" />
        </if>
    </select>
    <!-- 获取代垫收回列表分页数量 -->
    <select id="getMatcostsReimburseListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(1) from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <include refid="MatcostsReimbursePageList_Where_Clause"/>
        </trim>
    </select>
    <select id="getMatcostsReimburseSums" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        <choose>
            <when test="condition.dyncReimburseSumColumn !=null and condition.dyncReimburseColumn != null">
                SELECT SUM(reimburseamount) AS reimburseamount,SUM(writeoffamount) AS writeoffamount,SUM(remainderamount) AS remainderamount,SUM(expense) AS expense ${condition.dyncReimburseSumColumn}
                FROM (
                SELECT reimburseamount,writeoffamount,remainderamount,expense ${condition.dyncReimburseColumn}
                FROM t_js_matcostsinput
                <trim prefix="where" prefixOverrides="and|or" >
                    <include refid="common.Page_dataSql"/>
                    <include refid="common.Page_querySql"/>
                    <include refid="MatcostsReimbursePageList_Where_Clause"/>
                </trim>
                ) t
            </when>
            <otherwise>
                SELECT SUM(reimburseamount) AS reimburseamount,SUM(writeoffamount) AS writeoffamount,SUM(remainderamount) AS remainderamount,SUM(expense) AS expense
                FROM t_js_matcostsinput
                <trim prefix="where" prefixOverrides="and|or" >
                    <include refid="common.Page_dataSql"/>
                    <include refid="common.Page_querySql"/>
                    <include refid="MatcostsReimbursePageList_Where_Clause"/>
                </trim>
            </otherwise>
        </choose>
    </select>
    <select id="getMatcostsReimburseList" parameterType="com.hd.agent.common.util.PageMap" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_Column_List"/>
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="common.Page_dataSql"/>
            <include refid="common.Page_querySql"/>
            <if test="1==1">
                and billtype='2'
            </if>
            <if test="condition.businessdate != null">
                <![CDATA[ and businessdate =  #{condition.businessdate}  ]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.idarrs != null" >
                and FIND_IN_SET(id,#{condition.idarrs})
            </if>
            <if test="condition.iswriteoff != null" >
                and iswriteoff = #{condition.iswriteoff}
            </if>
            <if test="condition.showCanWriteoff != null" >
                <![CDATA[and iswriteoff <> '1']]>
            </if>
            <if test="condition.reimbursetype != null" >
                and reimbursetype = #{condition.reimbursetype}
            </if>
            <choose>
                <when test="condition.writeoffstatus == 1">
                    and iswriteoff = '1'
                </when>
                <when test="condition.writeoffstatus == 2">
                    <![CDATA[and iswriteoff <> '1' and iswriteoff <> '2']]>
                </when>
                <when test="condition.writeoffstatus == 3">
                    <![CDATA[and iswriteoff <> '2']]>
                </when>
            </choose>
        </trim>
        <if test="condition.isQueryByOrder != null">
            <choose>
                <when test="condition.orderBySql !=null and condition.orderBySql !=''">
                    order by ${condition.orderBySql}
                </when>
                <otherwise>
                    <if test="condition.orderSort !=null and condition.orderBy !=null">
                        order by ${condition.orderSort} ${condition.orderBy}
                    </if>
                </otherwise>

            </choose>
        </if>
    </select>
    <insert id="insertMatcostsStatement" parameterType="com.hd.agent.journalsheet.model.MatcostsInputStatement">
        insert into t_js_matcostsinput_statement
        <trim prefix="(" suffix=")" suffixOverrides="," >
            <if test="payid != null" >
                payid,
            </if>
            <if test="takebackid != null" >
                takebackid,
            </if>
            <if test="writeoffdate != null" >
                writeoffdate,
            </if>
            <if test="iswriteoff != null" >
                iswriteoff,
            </if>
            <if test="factoryamount != null" >
                factoryamount,
            </if>
            <if test="remainderamount != null" >
                remainderamount,
            </if>
            <if test="relateamount != null" >
                relateamount,
            </if>
            <if test="adduserid != null" >
                adduserid,
            </if>
            <if test="addusername != null" >
                addusername,
            </if>
            <if test="1==1" >
                addtime,
            </if>
            <if test="reimbursetype != null" >
                reimbursetype,
            </if>
            <if test="takebackamount != null" >
                takebackamount,
            </if>
            <if test="tbremainderamount != null" >
                tbremainderamount,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides="," >
            <if test="payid != null" >
                #{payid},
            </if>
            <if test="takebackid != null" >
                #{takebackid},
            </if>
            <if test="writeoffdate != null" >
                #{writeoffdate},
            </if>
            <if test="iswriteoff != null" >
                #{iswriteoff},
            </if>
            <if test="factoryamount != null" >
                #{factoryamount},
            </if>
            <if test="remainderamount != null" >
                #{remainderamount},
            </if>
            <if test="relateamount != null" >
                #{relateamount},
            </if>
            <if test="adduserid != null" >
                #{adduserid},
            </if>
            <if test="addusername != null" >
                #{addusername},
            </if>
            <choose>
                <when test="addtime != null">#{addtime},</when>
                <otherwise>now(),</otherwise>
            </choose>
            <if test="reimbursetype != null" >
                #{reimbursetype},
            </if>
            <if test="takebackamount != null" >
                #{takebackamount},
            </if>
            <if test="tbremainderamount != null" >
                #{tbremainderamount},
            </if>
        </trim>
        <selectKey resultType="int" keyProperty="id"
                   order="AFTER">
            select LAST_INSERT_ID() as id
        </selectKey>
    </insert>
    <delete id="deleteMatcostsStatement" parameterType="java.lang.String">
        delete from t_js_matcostsinput_statement where id=#{id}
    </delete>
    <sql id="MatcostsStatement_BaseColumn">
        id, payid,takebackid,writeoffdate,iswriteoff,factoryamount,remainderamount,relateamount,
        takebackamount,tbremainderamount,addtime,reimbursetype,adduserid,addusername
    </sql>
    <sql id="matcostsStatementPageList_Where_Clause">
        <if test="condition.begintime != null">
            <![CDATA[ and a.writeoffdate >= #{condition.begintime}  ]]>
        </if>
        <if test="condition.endtime != null">
            <![CDATA[ and a.writeoffdate <= #{condition.endtime}  ]]>
        </if>
        <if test="condition.ddbegintime != null">
            <![CDATA[ and b.businessdate >= #{condition.ddbegintime}  ]]>
        </if>
        <if test="condition.ddendtime != null">
            <![CDATA[ and b.businessdate <= #{condition.ddendtime}  ]]>
        </if>
        <if test="condition.supplierid != null">
            and b.supplierid=#{condition.supplierid}
        </if>
        <if test="condition.payidarr != null">
            and FIND_IN_SET(a.payid,#{condition.payidarr})
        </if>
        <if test="condition.takebackidarr != null">
            and FIND_IN_SET(a.takebackid,#{condition.takebackidarr})
        </if>
        <if test="condition.payid != null">
            and a.payid=#{condition.payid}
        </if>
        <if test="condition.takebackid != null">
            and a.takebackid=#{condition.takebackid}
        </if>
        <if test="condition.noDataFound != null">
            and 1=2
        </if>
    </sql>
    <select id="getMatcostsStatementPageList" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        SELECT a.id,a.payid,a.takebackid,a.writeoffdate,a.iswriteoff,a.factoryamount,a.remainderamount,(a.remainderamount-a.relateamount) as remainderamountafter,IFNULL(a.factoryamount-a.remainderamount,0.000000) as fwriteoffamount,
        a.relateamount,a.takebackamount,a.tbremainderamount,(a.tbremainderamount-a.relateamount) as tbremainderamountafter,a.addtime,a.reimbursetype,a.adduserid,IFNULL(a.takebackamount-a.remainderamount,0.000000) as tbwriteoffamount,
        a.addusername,b.oaid,b.businessdate ddbusinessdate,b.supplierid,b.supplierdeptid
        <if test="condition.dyncReimburseColumn !=null">
            ${condition.dyncReimburseColumn}
        </if>
        FROM t_js_matcostsinput_statement a INNER JOIN t_js_matcostsinput b on a.payid=b.id
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="matcostsStatementPageList_Where_Clause" />
        </trim>
        <if test="condition.isPageflag !='true'">
            <include refid="common.Page_limit" />
        </if>
    </select>
    <select id="getMatcostsStatementPageCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        SELECT count(a.payid)
        FROM t_js_matcostsinput_statement a INNER JOIN t_js_matcostsinput b on a.payid=b.id
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="matcostsStatementPageList_Where_Clause" />
        </trim>
    </select>
    <select id="getMatcostsStatementSums" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        SELECT SUM(relateamount) as relateamount <if test="condition.dyncReimburseSumColumn !=null"> ${condition.dyncReimburseSumColumn}</if> FROM (
        SELECT a.relateamount
        <if test="condition.dyncReimburseColumn !=null">
            ${condition.dyncReimburseColumn}
        </if>
        FROM t_js_matcostsinput_statement a INNER JOIN t_js_matcostsinput b on a.payid=b.id
        <trim prefix="where" prefixOverrides="and|or" >
            <include refid="matcostsStatementPageList_Where_Clause" />
        </trim>
        ) t
    </select>
    <select id="getMatcostsStatementList"  parameterType="map" resultType="com.hd.agent.journalsheet.model.MatcostsInputStatement">
        select
        <include refid="MatcostsStatement_BaseColumn"/>
        from t_js_matcostsinput_statement
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="payidarr != null">
                and FIND_IN_SET(payid,#{payidarr})
            </if>
            <if test="takebackidarr != null">
                and FIND_IN_SET(takebackid,#{takebackidarr})
            </if>
            <if test="takebackid != null">
                and takebackid=#{takebackid}
            </if>
            <if test="payid != null">
                and payid=#{payid}
            </if>
            <if test="iswriteoff != null">
                and iswriteoff=#{iswriteoff}
            </if>
            <if test="isQueryByOrder != null">
                <choose>
                    <when test="orderBySql !=null and orderBySql !=''">
                        order by ${orderBySql}
                    </when>
                    <otherwise>
                        <if test="orderSort !=null and orderBy !=null">
                            order by ${orderSort} ${orderBy}
                        </if>
                    </otherwise>

                </choose>
            </if>
        </trim>
    </select>
    <select id="getMatcostsStatementDetail"  parameterType="String" resultType="com.hd.agent.journalsheet.model.MatcostsInputStatement">
        select
        <include refid="MatcostsStatement_BaseColumn"/>
        from t_js_matcostsinput_statement
        where id=#{id}
    </select>
    <update id="updateMatcostsStatement" parameterType="com.hd.agent.journalsheet.model.MatcostsInputStatement">
        update t_js_matcostsinput_statement
        <set >
            <if test="payid != null" >
                payid=#{payid},
            </if>
            <if test="takebackid != null" >
                takebackid=#{takebackid},
            </if>
            <if test="writeoffdate != null" >
                writeoffdate=#{writeoffdate},
            </if>
            <if test="iswriteoff != null" >
                iswriteoff=#{iswriteoff},
            </if>
            <if test="factoryamount != null" >
                factoryamount=#{factoryamount},
            </if>
            <if test="remainderamount != null" >
                remainderamount=#{remainderamount},
            </if>
            <if test="relateamount != null" >
                relateamount=#{relateamount},
            </if>
            <if test="reimbursetype != null" >
                reimbursetype=#{reimbursetype},
            </if>
            <if test="takebackamount != null" >
                takebackamount=#{takebackamount},
            </if>
            <if test="tbremainderamount != null" >
                tbremainderamount=#{tbremainderamount},
            </if>
        </set>
        where id=#{id}
    </update>
    <update id="updateMatcostsStatementReiburseType" parameterType="com.hd.agent.journalsheet.model.MatcostsInputStatement">
        update t_js_matcostsinput_statement
        set reimbursetype=#{reimbursetype}
        where takebackid=#{takebackid}
    </update>
    <sql id="MatcostsInputWriteoffReportListSql">
        select id,businessdate,oaid,supplierid,supplierdeptid,customerid,subjectid,sum(factoryamount) as factoryamount,
        sum(htcompdiscount) as htcompdiscount,sum(htpayamount) as htpayamount,sum(branchaccount) as branchaccount,reimbursetype,
        0 as reimburseamount,sum(actingmatamount) as actingmatamount,adduserid,addusername,addtime,brandid,iswriteoff,
        writeoffdate,writeoffer,writeoffername,sum(writeoffamount) as writeoffamount,billtype,sum(factoryamount)-sum(writeoffamount) as unwriteoffamount
        <if test="condition.dyncReimburseSumColumn !=null">
            ${condition.dyncReimburseSumColumn}
        </if>
        from (
        select
        id,businessdate,oaid,supplierid,supplierdeptid,customerid,subjectid,factoryamount,
        htcompdiscount,htpayamount,branchaccount,reimbursetype,
        reimburseamount,actingmatamount,adduserid,addusername,addtime,brandid,iswriteoff,
        writeoffdate,writeoffer,writeoffername,writeoffamount,billtype
        <if test="condition.dyncReimburseColumn !=null">
            ${condition.dyncReimburseColumn}
        </if>
        from (
        SELECT
        id,businessdate,oaid,supplierid,supplierdeptid,customerid,subjectid,factoryamount,
        htcompdiscount,htpayamount,branchaccount,reimbursetype,
        0 as reimburseamount,actingmatamount,adduserid,addusername,addtime,brandid,iswriteoff,
        writeoffdate,'' writeoffer,'' writeoffername,0 as  writeoffamount,billtype,paydate,takebackdate
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and billtype='1' and iswriteoff='0'
            </if>
            <if test="condition.begintime != null">
                <![CDATA[ and businessdate >=  #{condition.begintime}  ]]>
            </if>
            <if test="condition.endtime != null">
                <![CDATA[ and businessdate <=  #{condition.endtime}  ]]>
            </if>
            <if test="condition.writeoffdate1 !=null or condition.writeoffdate2 !=null">
                and 1=2
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.iswriteoff != null" >
                and iswriteoff=#{condition.iswriteoff}
            </if>
            <if test="condition.QueryDataSql != null">
                and ${condition.QueryDataSql}
            </if>
        </trim>
        UNION ALL
        select
        m.id,m.businessdate,m.oaid,m.supplierid,m.supplierdeptid,m.customerid,m.subjectid,ms.relateamount as factoryamount,
        m.htcompdiscount,m.htpayamount,m.branchaccount,ms.reimbursetype as reimbursetype,
        0 as reimburseamount,m.actingmatamount,m.adduserid,m.addusername,m.addtime,m.brandid,m.iswriteoff,
        m.writeoffdate,m.writeoffer,m.writeoffername,ms.relateamount as writeoffamount,m.billtype,m.paydate,m.takebackdate
        from t_js_matcostsinput_statement ms
        inner join  t_js_matcostsinput m on ms.payid=m.id
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and m.iswriteoff='1' and m.billtype='1'
            </if>
            <if test="condition.begintime != null">
                <![CDATA[ and m.businessdate >= #{condition.begintime}  ]]>
            </if>
            <if test="condition.endtime != null">
                <![CDATA[ and m.businessdate <= #{condition.endtime}  ]]>
            </if>
            <if test="condition.writeoffdate1 != null">
                <![CDATA[ and m.writeoffdate >= #{condition.writeoffdate1}  ]]>
            </if>
            <if test="condition.writeoffdate2 != null">
                <![CDATA[ and m.writeoffdate <= #{condition.writeoffdate2}  ]]>
            </if>
            <if test="condition.supplierid != null" >
                and m.supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and m.supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.iswriteoff != null" >
                and m.iswriteoff=#{condition.iswriteoff}
            </if>
            <if test="condition.QueryDataSqlM != null">
                and ${condition.QueryDataSqlM}
            </if>
        </trim>
        ) t
        ) t
        <if test="condition.showSumAll !='true'">
            group by id
        </if>
    </sql>
    <select id="getMatcostsInputWriteoffReportList" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        select
        id,businessdate,oaid,supplierid,supplierdeptid,customerid,subjectid,factoryamount,
        htcompdiscount,htpayamount,branchaccount,reimbursetype,
        reimburseamount,actingmatamount,adduserid,addusername,addtime,brandid,iswriteoff,
        writeoffdate,writeoffer,writeoffername,writeoffamount,billtype,unwriteoffamount
        <if test="condition.reimburseSumColumn !=null">
            ${condition.reimburseSumColumn}
        </if>
        from (
        <if test="condition.groupcols !='id'">
            select id,businessdate,oaid,supplierid,supplierdeptid,customerid,subjectid,sum(factoryamount) as factoryamount,
            sum(htcompdiscount) as htcompdiscount,sum(htpayamount) as htpayamount,sum(branchaccount) as branchaccount,reimbursetype,
            sum(reimburseamount) as reimburseamount,sum(actingmatamount) as actingmatamount,adduserid,addusername,addtime,brandid,iswriteoff,
            writeoffdate,writeoffer,writeoffername,sum(writeoffamount) as writeoffamount,billtype,sum(unwriteoffamount) as unwriteoffamount
            <if test="condition.dyncReimburseSumColumn !=null">
                ${condition.dyncReimburseSumColumn}
            </if>
            from (
        </if>
        <include refid="MatcostsInputWriteoffReportListSql"></include>
        <if test="condition.groupcols !='id'">
            ) t
            <if test="condition.groupcols !=null and condition.groupcols !='' ">
                group by ${condition.groupcols}
            </if>
        </if>
        ) t
        <if test="condition.isPageflag !='true'">
            <include refid="common.Page_limit" />
        </if>
    </select>
    <select id="getMatcostsInputWriteoffReportCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(*) from (
        <if test="condition.groupcols !='id'">
            select id,businessdate,oaid,supplierid,supplierdeptid,customerid,subjectid,sum(factoryamount) as factoryamount,
            sum(htcompdiscount) as htcompdiscount,sum(htpayamount) as htpayamount,sum(branchaccount) as branchaccount,reimbursetype,
            sum(reimburseamount) as reimburseamount,sum(actingmatamount) as actingmatamount,adduserid,addusername,addtime,brandid,iswriteoff,
            writeoffdate,writeoffer,writeoffername,sum(writeoffamount) as writeoffamount,billtype,sum(unwriteoffamount) as unwriteoffamount
            <if test="condition.dyncReimburseSumColumn !=null">
                ${condition.dyncReimburseSumColumn}
            </if>
            from (
        </if>
        <include refid="MatcostsInputWriteoffReportListSql"></include>
        <if test="condition.groupcols !='id'">
            ) t
            <if test="condition.groupcols !=null and condition.groupcols !='' ">
                group by ${condition.groupcols}
            </if>
        </if>
        ) t
    </select>
    <select id="getMatcostsInputWriteoffReportSums" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        <include refid="MatcostsInputWriteoffReportListSql"></include>
    </select>
    <sql id="MatcostsReimburseWriteoffReportListSql">
        select id,businessdate,supplierid,supplierdeptid,reimbursetype,
        sum(reimburseamount) as reimburseamount,iswriteoff,
        writeoffdate,writeoffer,writeoffername,sum(writeoffamount) as writeoffamount,billtype,sum(reimburseamount)-sum(writeoffamount) as unwriteoffamount
        <if test="condition.dyncReimburseSumColumn !=null">
            ${condition.dyncReimburseSumColumn}
        </if>
        from (
        select
        id,businessdate,supplierid,supplierdeptid,reimbursetype,
        reimburseamount,iswriteoff,writeoffdate,writeoffer,writeoffername,writeoffamount,billtype
        <if test="condition.dyncReimburseColumn !=null">
            ${condition.dyncReimburseColumn}
        </if>
        from (
        SELECT
        id,businessdate,supplierid,supplierdeptid,reimbursetype,reimburseamount,'0' as iswriteoff,
        writeoffdate,'' writeoffer,'' writeoffername,0 as writeoffamount,billtype
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and billtype='2' and iswriteoff='0'
            </if>
            <if test="condition.writeoffdate1 !=null or condition.writeoffdate2 !=null">
                and 1=2
            </if>
            <if test="condition.begintime != null">
                <![CDATA[ and businessdate >= #{condition.begintime}  ]]>
            </if>
            <if test="condition.endtime != null">
                <![CDATA[ and businessdate <= #{condition.endtime}  ]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.iswriteoff == 1" >
                and 1=2
            </if>
            <if test="condition.QueryDataSql != null">
                and ${condition.QueryDataSql}
            </if>
        </trim>
        union all
        select
        m.id,m.businessdate,m.supplierid,m.supplierdeptid,ms.reimbursetype as reimbursetype,ms.relateamount as reimburseamount,
        '1' as iswriteoff,m.writeoffdate,m.writeoffer,m.writeoffername,ms.relateamount as writeoffamount,m.billtype
        from t_js_matcostsinput_statement ms
        inner join  t_js_matcostsinput m on ms.takebackid=m.id
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and m.iswriteoff='1'  and m.billtype='2'
            </if>
            <if test="condition.begintime != null">
                <![CDATA[ and m.businessdate >= #{condition.begintime}  ]]>
            </if>
            <if test="condition.endtime != null">
                <![CDATA[ and m.businessdate <= #{condition.endtime}  ]]>
            </if>
            <if test="condition.writeoffdate1 != null">
                <![CDATA[ and m.writeoffdate >= #{condition.writeoffdate1}  ]]>
            </if>
            <if test="condition.writeoffdate2 != null">
                <![CDATA[ and m.writeoffdate <= #{condition.writeoffdate2}  ]]>
            </if>
            <if test="condition.supplierid != null" >
                and m.supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and m.supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.iswriteoff == 0" >
                and 1=2
            </if>
            <if test="condition.QueryDataSqlM != null">
                and ${condition.QueryDataSqlM}
            </if>
        </trim>
        UNION ALL
        select
        m.id,m.businessdate,m.supplierid,m.supplierdeptid,ms.reimbursetype as reimbursetype,
        0 reimburseamount,'1' as iswriteoff,
        m.writeoffdate,m.writeoffer,m.writeoffername, ms.relateamount as writeoffamount,m.billtype
        from t_js_matcostsinput_statement ms
        inner join  t_js_matcostsinput m on ms.takebackid=m.id
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and m.iswriteoff='2'  and m.billtype='2'
            </if>
            <if test="condition.begintime != null">
                <![CDATA[ and  m.businessdate >=  #{condition.begintime}  ]]>
            </if>
            <if test="condition.endtime != null">
                <![CDATA[ and  m.businessdate <=  #{condition.endtime}  ]]>
            </if>
            <if test="condition.writeoffdate1 != null">
                <![CDATA[ and  m.writeoffdate >=  #{condition.writeoffdate1}  ]]>
            </if>
            <if test="condition.writeoffdate2 != null">
                <![CDATA[ and  m.writeoffdate <=  #{condition.writeoffdate2}  ]]>
            </if>
            <if test="condition.supplierid != null" >
                and m.supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and m.supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.iswriteoff == 0" >
                and 1=2
            </if>
            <if test="condition.QueryDataSqlM != null">
                and ${condition.QueryDataSqlM}
            </if>
        </trim>
        UNION ALL
        SELECT
        id,businessdate,supplierid,supplierdeptid,reimbursetype,reimburseamount,
        <choose>
            <when test="condition.iswriteoff==1">'1' as iswriteoff,</when>
            <when test="condition.iswriteoff==0">'0' as iswriteoff,</when>
            <otherwise>iswriteoff,</otherwise>
        </choose>
        writeoffdate,'' writeoffer,'' writeoffername,
        <choose>
            <when test="condition.iswriteoff==0">writeoffamount,</when>
            <otherwise>0 as writeoffamount,</otherwise>
        </choose>
        billtype
        from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="1==1">
                and billtype='2' and iswriteoff='2'
            </if>
            <if test="condition.begintime != null">
                <![CDATA[ and businessdate >=  #{condition.begintime}  ]]>
            </if>
            <if test="condition.endtime != null">
                <![CDATA[ and businessdate <=  #{condition.endtime}  ]]>
            </if>
            <if test="condition.writeoffdate1 != null">
                <![CDATA[ and  writeoffdate >=  #{condition.writeoffdate1}  ]]>
            </if>
            <if test="condition.writeoffdate2 != null">
                <![CDATA[ and  writeoffdate <=  #{condition.writeoffdate2}  ]]>
            </if>
            <if test="condition.supplierid != null" >
                and supplierid = #{condition.supplierid}
            </if>
            <if test="condition.supplierdeptid != null" >
                and supplierdeptid like concat(#{condition.supplierdeptid},'%')
            </if>
            <if test="condition.QueryDataSql != null">
                and ${condition.QueryDataSql}
            </if>
        </trim>
        ) t
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="condition.iswriteoff != null" >
                and iswriteoff=#{condition.iswriteoff}
            </if>
        </trim>
        ) t
        <if test="condition.showSumAll !='true'">
            group by id
        </if>
    </sql>
    <select id="getMatcostsReimburseWriteoffReportList" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        select
        id,businessdate,supplierid,supplierdeptid,reimbursetype,reimburseamount,iswriteoff,
        writeoffdate,writeoffer,writeoffername,writeoffamount,billtype,unwriteoffamount
        <if test="condition.reimburseSumColumn !=null">
            ${condition.reimburseSumColumn}
        </if>
        from (
        <if test="condition.groupcols !='id'">
            select id,businessdate,supplierid,supplierdeptid,reimbursetype, sum(reimburseamount) as reimburseamount,iswriteoff,
            writeoffdate,writeoffer,writeoffername,sum(writeoffamount) as writeoffamount,billtype,sum(unwriteoffamount) as unwriteoffamount
            <if test="condition.dyncReimburseSumColumn !=null">
                ${condition.dyncReimburseSumColumn}
            </if>
            from (
        </if>
        <include refid="MatcostsReimburseWriteoffReportListSql"></include>
        <if test="condition.groupcols !='id'">
            ) t
            <if test="condition.groupcols !=null and condition.groupcols !='' ">
                group by ${condition.groupcols}
            </if>
        </if>
        ) t
        <if test="condition.isPageflag !='true'">
            <include refid="common.Page_limit" />
        </if>
    </select>
    <select id="getMatcostsReimburseWriteoffReportCount" parameterType="com.hd.agent.common.util.PageMap" resultType="int">
        select count(*) from (
        <if test="condition.groupcols !='id'">
            select id,businessdate,supplierid,supplierdeptid,reimbursetype,sum(reimburseamount) as reimburseamount,iswriteoff,
            writeoffdate,writeoffer,writeoffername,sum(writeoffamount) as writeoffamount,billtype,sum(unwriteoffamount) as unwriteoffamount
            <if test="condition.dyncReimburseSumColumn !=null">
                ${condition.dyncReimburseSumColumn}
            </if>
            from (
        </if>
        <include refid="MatcostsReimburseWriteoffReportListSql"></include>
        <if test="condition.groupcols !='id'">
            ) t
            <if test="condition.groupcols !=null and condition.groupcols !='' ">
                group by ${condition.groupcols}
            </if>
        </if>
        ) t
    </select>

    <select id="getMatcostsReimburseWriteoffReportSums" parameterType="com.hd.agent.common.util.PageMap" resultType="map">
        <include refid="MatcostsReimburseWriteoffReportListSql"></include>
    </select>

    <delete id="deleteMatcostsInputByOA" parameterType="java.lang.String">
        delete from t_js_matcostsinput where oaid=#{oaid}
    </delete>
    <select id="selectMatcostsInputByOaid" parameterType="java.lang.String" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_BaseColumn"/>
        from t_js_matcostsinput
        where oaid = #{oaid }
        and sourcefrome in ('2', '3')
        order by addtime desc, id desc
    </select>
    <sql id="selectMatcostsBalanceList_sql_Matcostsinput_HX">
        <!-- 收入使用代垫核销-->
        SELECT
        t1.writeoffdate as businessdate, t1.supplierid, t1.supplierdeptid deptid, SUM(t1.writeoffamount) income
        FROM t_js_matcostsinput t1
        <if test="condition.customersort != null">
        left join t_base_sales_customer t5 on t1.customerid = t5.id
        </if>
        <trim prefix="where" prefixOverrides="and|or">
            and t1.billtype = '1' and t1.iswriteoff='1'
            <if test="condition.begindate != null">
                <![CDATA[ and t1.writeoffdate  >=  #{condition.begindate}  ]]>
            </if>
            <if test="condition.enddate != null">
                <![CDATA[ and t1.writeoffdate  <=  #{condition.enddate}  ]]>
            </if>
            <if test="condition.supplierid != null">
                and t1.supplierid = #{condition.supplierid }
            </if>
            <if test="condition.deptid != null">
                <![CDATA[and t1.supplierdeptid like CONCAT(#{condition.deptid},'%')]]>
            </if>
            <if test="condition.salesdeptid != null">
                <![CDATA[and t1.supplierdeptid like CONCAT(#{condition.salesdeptid},'%')]]>
            </if>
            <if test="condition.businessyearmonth != null">
                <![CDATA[and t1.writeoffdate like CONCAT(#{condition.businessyearmonth},'%')]]>
            </if>
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
        </trim>
        GROUP BY t1.writeoffdate, t1.supplierid, t1.supplierdeptid
    </sql>
    <sql id="selectMatcostsBalanceList_sql_Matcostsinput_SH">
        <!-- 收入使用代垫收回-->
        SELECT
        t1.businessdate, t1.supplierid, t1.supplierdeptid deptid, SUM(t1.reimburseamount) income
        FROM t_js_matcostsinput t1
        <if test="condition.customersort != null">
            left join t_base_sales_customer t5 on t1.customerid = t5.id
        </if>
        <trim prefix="where" prefixOverrides="and|or">
            and t1.billtype = '2'
            <if test="condition.begindate != null">
                <![CDATA[and t1.businessdate  >=  #{condition.begindate }]]>
            </if>
            <if test="condition.enddate != null">
                <![CDATA[and t1.businessdate  <=  #{condition.enddate }]]>
            </if>
            <if test="condition.supplierid != null">
                and t1.supplierid = #{condition.supplierid }
            </if>
            <if test="condition.deptid != null">
                <![CDATA[and t1.supplierdeptid like CONCAT(#{condition.deptid},'%')]]>
            </if>
            <if test="condition.salesdeptid != null">
                <![CDATA[and t1.supplierdeptid like CONCAT(#{condition.salesdeptid},'%')]]>
            </if>
            <if test="condition.businessyearmonth != null">
                <![CDATA[and t1.businessdate like CONCAT(#{condition.businessyearmonth},'%')]]>
            </if>
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
        </trim>
        GROUP BY t1.businessdate, t1.supplierid, t1.supplierdeptid
    </sql>
    <!-- 代垫收支情况表查询sql -->
    <!-- 修改：20150825 修改人：张红辉 -->
    <!-- 修改内容：收入部分日期按核销后的日期来查询,原先按业务日期查询 -->
    <!-- 修改：20151204 修改人：张红辉 -->
    <!-- 修改内容：根据系统参数判断收入使用代垫核销金额，还是代垫收回金额-->
    <sql id="selectMatcostsBalanceList_sql">
        SELECT t1.businessdate, t1.supplierid, t1.deptid, t1.income, IFNULL(t2.outcome, 0.00) outcome
        FROM (
        <choose>
            <when test="condition.queryAndUseMatcostsinputHXorSH==1">
                <include refid="selectMatcostsBalanceList_sql_Matcostsinput_HX"></include>
            </when>
            <when test="condition.queryAndUseMatcostsinputHXorSH==2">
                <include refid="selectMatcostsBalanceList_sql_Matcostsinput_SH"></include>
            </when>
            <otherwise>
                <include refid="selectMatcostsBalanceList_sql_Matcostsinput_HX"></include>
            </otherwise>
        </choose>
        ) t1
        LEFT JOIN
        (
        SELECT
        t1.businessdate, t1.supplierid, t1.deptid deptid, SUM(amount) outcome
        FROM t_js_customercost_payable t1
        <if test="condition.customersort != null">
            left join t_base_sales_customer t5 on t1.customerid = t5.id
        </if>
        <trim prefix="where" prefixOverrides="and|or">
            <if test="condition.begindate != null">
                <![CDATA[ and t1.businessdate >=  #{condition.begindate } ]]>
            </if>
            <if test="condition.enddate != null">
                <![CDATA[ and t1.businessdate  <=  #{condition.enddate } ]]>
            </if>
            <if test="condition.supplierid != null">
                and t1.supplierid = #{condition.supplierid }
            </if>
            <if test="condition.deptid != null">
                <![CDATA[and t1.deptid like CONCAT(#{condition.deptid},'%')]]>
            </if>
            <if test="condition.salesdeptid != null">
                <![CDATA[and t1.deptid like CONCAT(#{condition.salesdeptid},'%')]]>
            </if>
            <if test="condition.businessyearmonth != null">
                <![CDATA[ and t1.businessdate like CONCAT(#{condition.businessyearmonth},'%')]]>
            </if>
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
            <if test="1==1">
                and t1.billtype = '2'
                and (t1.sourcefrom IS NULL OR t1.sourcefrom <![CDATA[ <> ]]> '11')
                and t1.paytype = '1'
            </if>
        </trim>
        GROUP BY t1.businessdate, t1.supplierid, t1.deptid
        ) t2 ON t1.businessdate = t2.businessdate AND t1.supplierid = t2.supplierid AND t1.deptid = t2.deptid

        UNION

        SELECT t1.businessdate, t1.supplierid, t1.deptid, IFNULL(t2.income, 0.00) income, t1.outcome
        FROM
        (
        SELECT t1.businessdate, t1.supplierid, t1.deptid deptid, SUM(amount) outcome
        FROM t_js_customercost_payable t1
        <if test="condition.customersort != null">
            left join t_base_sales_customer t5 on t1.customerid = t5.id
        </if>
        <trim prefix="where" prefixOverrides="and|or">
            <if test="condition.begindate != null">
                and t1.businessdate <![CDATA[ >= ]]> #{condition.begindate }
            </if>
            <if test="condition.enddate != null">
                and t1.businessdate <![CDATA[ <= ]]> #{condition.enddate }
            </if>
            <if test="condition.supplierid != null">
                and t1.supplierid = #{condition.supplierid }
            </if>
            <if test="condition.deptid != null">
                <![CDATA[and t1.deptid like CONCAT(#{condition.deptid},'%')]]>
            </if>
            <if test="condition.salesdeptid != null">
                <![CDATA[and t1.deptid like CONCAT(#{condition.salesdeptid},'%')]]>
            </if>
            <if test="condition.businessyearmonth != null">
                <![CDATA[and t1.businessdate like CONCAT(#{condition.businessyearmonth},'%')]]>
            </if>
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
            <if test="1==1">
                and t1.billtype = '2'
                and (t1.sourcefrom IS NULL OR t1.sourcefrom <![CDATA[ <> ]]> '11')
                and t1.paytype = '1'
            </if>
        </trim>
        GROUP BY t1.businessdate, t1.supplierid, t1.deptid
        ) t1
        LEFT JOIN
        (
	        <choose>
		        <when test="condition.queryAndUseMatcostsinputHXorSH==1">
		            <include refid="selectMatcostsBalanceList_sql_Matcostsinput_HX"></include>
		        </when>
		        <when test="condition.queryAndUseMatcostsinputHXorSH==2">
		            <include refid="selectMatcostsBalanceList_sql_Matcostsinput_SH"></include>
		        </when>
		        <otherwise>
		            <include refid="selectMatcostsBalanceList_sql_Matcostsinput_HX"></include>
		        </otherwise>
	        </choose>
        )t2 ON t1.businessdate = t2.businessdate AND t1.supplierid = t2.supplierid AND t1.deptid = t2.deptid
    </sql>
    <select id="selectMatcostsBalanceList" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">

        select
        id,
        supplierid,
        suppliername,
        deptid,
        deptname,
        income,
        outcome,
        balance,
        null businessdate,
        <choose>
            <when test="condition.begindate !=null ">
                #{condition.begindate } as begindate,
            </when>
            <otherwise>
                '' as begindate,
            </otherwise>
        </choose>
        <choose>
            <when test="condition.enddate !=null ">
                #{condition.enddate } as enddate,
            </when>
            <otherwise>
                '' as enddate,
            </otherwise>
        </choose>
        <choose>
            <when test="condition.customersort !=null ">
                #{condition.customersort } as customersort
            </when>
            <otherwise>
                '' as customersort
            </otherwise>
        </choose>
        from
        (

        select
        concat(t1.supplierid, t1.deptid) id,
        t1.supplierid,
        t1.deptid,
        t2.name suppliername,
        t3.name deptname,
        sum(income) income,
        sum(outcome) outcome,
        (sum(income) - sum(outcome)) balance
        from (
        <include refid="selectMatcostsBalanceList_sql"/>
        ) t1
        inner join t_base_buy_supplier t2 on t1.supplierid = t2.id
        inner join t_base_department t3 on t1.deptid = t3.id

        <trim prefix="where" prefixOverrides="and|or">
            and 1 = 1
            /*and (t1.income <![CDATA[ > ]]> 0 or  t1.outcome <![CDATA[ > ]]> 0)*/
            <include refid="common.Page_querySql"/>
            <include refid="common.Page_dataSql"/>
        </trim>
        group by t1.supplierid, t1.deptid
        order by t1.supplierid, t1.deptid
        )t
        <include refid="common.Page_limit"/>
    </select>
    <select id="selectMatcostsBalanceListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="java.lang.Integer">

        select count(1) from
        (

        select
        t1.supplierid,
        t1.deptid,
        sum(income) income,
        sum(outcome) outcome,
        (sum(income) - sum(outcome)) balance
        from (
        <include refid="selectMatcostsBalanceList_sql"/>
        ) t1
        inner join t_base_buy_supplier t2 on t1.supplierid = t2.id
        inner join t_base_department t3 on t1.deptid = t3.id
        <trim prefix="where" prefixOverrides="and|or">
            and 1=1
            /*and (t1.income <![CDATA[ > ]]> 0 or  t1.outcome <![CDATA[ > ]]> 0)*/
            <include refid="common.Page_querySql"/>
            <include refid="common.Page_dataSql"/>
        </trim>
        group by t1.supplierid, t1.deptid
        )t
    </select>
    <select id="selectMatcostsBalanceSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">

        select
        sum(income) income,
        sum(outcome) outcome,
        (sum(income) - sum(outcome)) balance
        from (
        <include refid="selectMatcostsBalanceList_sql"/>
        ) t1
        inner join t_base_buy_supplier t2 on t1.supplierid = t2.id
        inner join t_base_department t3 on t1.deptid = t3.id

        <trim prefix="where" prefixOverrides="and|or">
            and 1=1
            <include refid="common.Page_querySql"/>
            <include refid="common.Page_dataSql"/>
        </trim>

    </select>

    <sql id="selectMatcostsBalanceDetailList_Sql_Matcostsinput_HX">
        select
        t1.oaid,
        t1.customerid,
        t1.writeoffdate as businessdate,
        t1.supplierid,
        t1.supplierdeptid deptid,
        t1.writeoffamount income,
        0 outcome,
        t1.subjectid subjectid,
        t1.writeoffamount balance,
        t1.hcflag,
        t1.remark
        from t_js_matcostsinput t1
        <trim prefix="where" prefixOverrides="and|or">
            and billtype = '1' and iswriteoff='1'
            <if test="condition.begindate != null">
                <![CDATA[and t1.writeoffdate  >=  #{condition.begindate }]]>
            </if>
            <if test="condition.enddate != null">
                <![CDATA[and t1.writeoffdate  <=  #{condition.enddate }]]>
            </if>
            <if test="condition.supplierid != null">
                and t1.supplierid = #{condition.supplierid }
            </if>
            <if test="condition.customerid != null">
                and t1.customerid = #{condition.customerid }
            </if>
            <if test="condition.deptid != null">
                and t1.supplierdeptid = #{condition.deptid }
            </if>
            <if test="condition.subjectid != null">
                and t1.subjectid = #{condition.subjectid }
            </if>
            <choose>
                <when test="condition.ishcflag == 1">
                    and (t1.hcflag = '1' or t1.hcflag = '2')
                </when>
                <when test="condition.ishcflag == 2">
                    and (t1.hcflag='0' or length(t1.hcflag)=0)
                </when>
            </choose>
            and t1.writeoffamount <![CDATA[ <> ]]> 0
        </trim>
    </sql>

    <sql id="selectMatcostsBalanceDetailList_Sql_Matcostsinput_SH">
        select
        t1.oaid,
        t1.customerid,
        t1.businessdate as businessdate,
        t1.supplierid,
        t1.supplierdeptid deptid,
        t1.reimburseamount income,
        0 outcome,
        t1.subjectid subjectid,
        t1.reimburseamount balance,
        t1.hcflag,
        t1.remark
        from t_js_matcostsinput t1
        <trim prefix="where" prefixOverrides="and|or">
            and billtype = '2'
            <if test="condition.begindate != null">
                <![CDATA[and t1.businessdate  >=  #{condition.begindate }]]>
            </if>
            <if test="condition.enddate != null">
                <![CDATA[and t1.businessdate  <=  #{condition.enddate }]]>
            </if>
            <if test="condition.supplierid != null">
                and t1.supplierid = #{condition.supplierid }
            </if>
            <if test="condition.customerid != null">
                and t1.customerid = #{condition.customerid }
            </if>
            <if test="condition.deptid != null">
                and t1.supplierdeptid = #{condition.deptid }
            </if>
            <if test="condition.subjectid != null">
                and t1.subjectid = #{condition.subjectid }
            </if>
            <choose>
                <when test="condition.ishcflag == 1">
                    and (t1.hcflag = '1' or t1.hcflag = '2')
                </when>
                <when test="condition.ishcflag == 2">
                    and (t1.hcflag='0' or length(t1.hcflag)=0)
                </when>
            </choose>
            and t1.reimburseamount <![CDATA[ <> ]]> 0
        </trim>
    </sql>

    <!-- 代垫收支情况明细查询sql -->
    <!-- 修改：20150825 修改人：张红辉 -->
    <!-- 修改内容：收入部分日期按核销后的日期来查询,原先按业务日期查询 -->
    <!-- 修改：20151204 修改人：张红辉 -->
    <!-- 修改内容：根据系统参数判断收入使用代垫核销金额，还是代垫收回金额-->
    <sql id="selectMatcostsBalanceDetailList_Sql">
        select
        null oaid,
        null customerid,
        null businessdate,
        null supplierid,
        null deptid,
        null income,
        null outcome,
        null subjectid,
        null balance,
        null hcflag,
        null remark
        from t_js_matcostsinput
        where 1 = 2
        <choose>
            <when test="condition.balancetype == '1'">
                union all
                <choose>
                    <when test="condition.queryAndUseMatcostsinputHXorSH==1">
                        <include refid="selectMatcostsBalanceDetailList_Sql_Matcostsinput_HX"></include>
                    </when>
                    <when test="condition.queryAndUseMatcostsinputHXorSH==2">
                        <include refid="selectMatcostsBalanceDetailList_Sql_Matcostsinput_SH"></include>
                    </when>
                    <otherwise>
                        <include refid="selectMatcostsBalanceDetailList_Sql_Matcostsinput_HX"></include>
                    </otherwise>
                </choose>
            </when>
            <when test="condition.balancetype == '2'">
                union all
                select
                t2.oaid,
                t2.customerid,
                t2.businessdate,
                t2.supplierid,
                t2.deptid deptid,
                0 income,
                t2.amount outcome,
                t2.expensesort subjectid,
                t2.amount balance,
                t2.hcflag,
                t2.remark
                from t_js_customercost_payable t2
                <trim prefix="where" prefixOverrides="and|or">
                    <if test="condition.begindate != null">
                        <![CDATA[and t2.businessdate >= #{condition.begindate }]]>
                    </if>
                    <if test="condition.enddate != null">
                        <![CDATA[and t2.businessdate <= #{condition.enddate }]]>
                    </if>
                    <if test="condition.supplierid != null">
                        and t2.supplierid = #{condition.supplierid }
                    </if>
                    <if test="condition.customerid != null">
                        and t2.customerid = #{condition.customerid }
                    </if>
                    <if test="condition.deptid != null">
                        and t2.deptid = #{condition.deptid }
                    </if>
                    <if test="condition.subjectid != null">
                        and t2.expensesort = #{condition.subjectid }
                    </if>
                    <choose>
                        <when test="condition.ishcflag == 1">
                            and (t2.hcflag = '1' or t2.hcflag = '2')
                        </when>
                        <when test="condition.ishcflag == 2">
                            and (t2.hcflag='0' or length(t2.hcflag)=0)
                        </when>
                    </choose>
                    and billtype = '2'
                    and (t2.sourcefrom IS NULL OR t2.sourcefrom <![CDATA[ <> ]]> '11')
                    and t2.paytype = '1'
                    /*and t2.amount <![CDATA[ <> ]]> 0*/
                </trim>
            </when>
            <otherwise>
                union all
                <choose>
                    <when test="condition.queryAndUseMatcostsinputHXorSH==1">
                        <include refid="selectMatcostsBalanceDetailList_Sql_Matcostsinput_HX"></include>
                    </when>
                    <when test="condition.queryAndUseMatcostsinputHXorSH==2">
                        <include refid="selectMatcostsBalanceDetailList_Sql_Matcostsinput_SH"></include>
                    </when>
                    <otherwise>
                        <include refid="selectMatcostsBalanceDetailList_Sql_Matcostsinput_HX"></include>
                    </otherwise>
                </choose>
                union all
                select
                t2.oaid,
                t2.customerid,
                t2.businessdate,
                t2.supplierid,
                t2.deptid deptid,
                0 income,
                t2.amount outcome,
                t2.expensesort subjectid,
                t2.amount balance,
                t2.hcflag,
                t2.remark
                from t_js_customercost_payable t2
                <trim prefix="where" prefixOverrides="and|or">
                    <if test="condition.begindate != null">
                        and t2.businessdate <![CDATA[ >= ]]> #{condition.begindate }
                    </if>
                    <if test="condition.enddate != null">
                        and t2.businessdate <![CDATA[ <= ]]> #{condition.enddate }
                    </if>
                    <if test="condition.supplierid != null">
                        and t2.supplierid = #{condition.supplierid }
                    </if>
                    <if test="condition.customerid != null">
                        and t2.customerid = #{condition.customerid }
                    </if>
                    <if test="condition.deptid != null">
                        and t2.deptid = #{condition.deptid }
                    </if>
                    <if test="condition.subjectid != null">
                        and t2.expensesort = #{condition.subjectid }
                    </if>
                    <choose>
                        <when test="condition.ishcflag == 1">
                            and (t2.hcflag = '1' or t2.hcflag = '2')
                        </when>
                        <when test="condition.ishcflag == 2">
                            and (t2.hcflag='0' or length(t2.hcflag)=0)
                        </when>
                    </choose>
                    and billtype = '2'
                    and (t2.sourcefrom IS NULL OR t2.sourcefrom <![CDATA[ <> ]]> '11')
                    and t2.paytype = '1'
                    /*and t2.amount <![CDATA[ <> ]]> 0*/
                </trim>
            </otherwise>
        </choose>
    </sql>
    <select id="selectMatcostsBalanceDetailList" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">

        select
        t1.oaid,
        t1.customerid,
        t1.businessdate,
        t1.supplierid,
        t1.deptid,
        t1.income,
        t1.outcome,
        t1.subjectid,
        t1.balance,
        t2.name suppliername,
        t3.name subjectname,
        t4.name deptname,
        t5.name customername,
        t6.name customersortname,
        t1.hcflag,
        t1.remark
        from
        (
        <include refid="selectMatcostsBalanceDetailList_Sql"></include>
        )t1
        inner join t_base_buy_supplier t2 on t1.supplierid = t2.id
        left join t_base_finance_expenses_sort t3 on t1.subjectid = t3.id
        left join t_base_department t4 on t1.deptid = t4.id
        left join t_base_sales_customer t5 on t1.customerid = t5.id
        left join t_base_sales_customersort t6 on t5.customersort = t6.id
        <trim prefix="where" prefixOverrides="and|or">
            and 1 = 1
            <choose>
                <when test="condition.balancetype == 1">
                    and t1.income <![CDATA[ <> ]]> 0
                </when>
                <when test="condition.balancetype == 2">
                    and t1.outcome <![CDATA[ <> ]]> 0
                </when>
                <otherwise>
                    and (t1.income <![CDATA[ <> ]]> 0 or  t1.outcome <![CDATA[ <> ]]> 0)
                </otherwise>
            </choose>
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
            <include refid="common.Page_querySql"/>
            <include refid="common.Page_dataSql"/>
        </trim>
        <if test="condition.isPageflag !='true'">
            <include refid="common.Page_limit" />
        </if>

    </select>
    <select id="selectMatcostsBalanceDetailListCount" parameterType="com.hd.agent.common.util.PageMap" resultType="java.lang.Integer">

        select
        count(1)
        from
        (
        <include refid="selectMatcostsBalanceDetailList_Sql"></include>
        )t1
        inner join t_base_buy_supplier t2 on t1.supplierid = t2.id
        left join t_base_sales_customer t5 on t1.customerid = t5.id
        <trim prefix="where" prefixOverrides="and|or">
            and 1 = 1
            <choose>
                <when test="condition.balancetype == 1">
                    and t1.income <![CDATA[ <> ]]> 0
                </when>
                <when test="condition.balancetype == 2">
                    and t1.outcome <![CDATA[ <> ]]> 0
                </when>
                <otherwise>
                    and (t1.income <![CDATA[ <> ]]> 0 or  t1.outcome <![CDATA[ <> ]]> 0)
                </otherwise>
            </choose>
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
            <include refid="common.Page_querySql"/>
            <include refid="common.Page_dataSql"/>
        </trim>
    </select>
    <select id="selectMatcostsBalanceDetailSum" parameterType="com.hd.agent.common.util.PageMap" resultType="java.util.Map">

        select
        sum(income) income,
        sum(outcome) outcome,
        sum(balance) balance
        from
        (
        select
        businessdate,
        supplierid,
        deptid,
        income,
        outcome,
        subjectid,
        balance
        from
        (
        <include refid="selectMatcostsBalanceDetailList_Sql"></include>
        ) t1
        inner join t_base_buy_supplier t2 on t1.supplierid = t2.id
        left join t_base_sales_customer t5 on t1.customerid = t5.id
        <trim prefix="where" prefixOverrides="and|or">
            and 1 = 1
            <if test="condition.customersort != null">
                and t5.customersort=#{condition.customersort}
            </if>
            <include refid="common.Page_querySql"/>
            <include refid="common.Page_dataSql"/>
        </trim>
        )t

    </select>
  		
  	<update id="updateMatcostsInputPrinttimes" parameterType="com.hd.agent.journalsheet.model.MatcostsInput">
		update t_js_matcostsinput
	    <set>
	      <if test="printtimes != null">
	        printtimes = IFNULL(printtimes,0)+1,
	      </if>
	    </set>
	    where id = #{id}
   </update>
  		
   <update id="updateMatcostsReimbursePrinttimes" parameterType="com.hd.agent.journalsheet.model.MatcostsInput">
		update t_js_matcostsinput
	    <set>
	      <if test="shprinttimes != null">
	        shprinttimes = IFNULL(shprinttimes,0)+1,
	      </if>
	    </set>
	    where id = #{id}
   </update>
    <update id="updateMatcostsInputVouchertimes" parameterType="com.hd.agent.journalsheet.model.MatcostsInput">
        update t_js_matcostsinput
        <set>
            <if test="vouchertimes != null">
                vouchertimes = IFNULL(vouchertimes,0)+1,
            </if>
        </set>
        where id = #{id}
    </update>
   <select id="getMatcostsReimburseListBy" parameterType="com.hd.agent.journalsheet.model.MatcostsInput" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
   		select   		
        <include refid="MatcostsInput_Column_List"/> 
		from t_js_matcostsinput
        <trim prefix="where" prefixOverrides="and|or" >
		 	<if test="dataSql != null">
                and ${dataSql}
		  	</if>
   			<if test="1==1">
	            and billtype='2'
	        </if>
	        <if test="subjectid != null" >
	            and subjectid = #{subjectid}
	        </if>
	        <if test="supplierid != null" >
	            and supplierid = #{supplierid}
	        </if>
	        <if test="customerid != null" >
	            and customerid = #{customerid}
	        </if>
	        <if test="supplierdeptid != null" >
	            and supplierdeptid like concat(#{supplierdeptid},'%')
	        </if>
	        <if test="reimbursetype != null" >
	            and reimbursetype = #{reimbursetype}
	        </if>
	        <if test="idarrs != null" >
	            and FIND_IN_SET(id,#{idarrs})
	        </if>
	        <if test="oaidarr != null" >
	            and FIND_IN_SET(oaid,#{oaidarr})
	        </if>
	        <if test="iswriteoff != null" >
	            and iswriteoff = #{iswriteoff}
	        </if>
   		</trim>
   </select>
    <select id="getMatcostsInputListBy" parameterType="java.util.Map" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_BaseColumn"/>
        from t_js_matcostsinput t
        <trim prefix="where" prefixOverrides="and|or" >
            <if test="dataSql != null">
                and ${dataSql}
            </if>
            <if test="1 == 1">
                and billtype='1'
            </if>
            <if test="idarrs != null" >
                and FIND_IN_SET(id,#{idarrs})
            </if>
        </trim>
    </select>
    <select id="getMatcostsNoWriteoffListBySupplierid" parameterType="java.lang.String" resultType="com.hd.agent.journalsheet.model.MatcostsInput">
        select
        <include refid="MatcostsInput_BaseColumn"/>
        from t_js_matcostsinput t
        where iswriteoff='0' and supplierid=#{supplierid} and billtype='1' order by duefromdate desc
    </select>
    <update id="updateMatcostsDuefromdateByBillid" parameterType="java.lang.String">
        UPDATE t_js_matcostsinput SET duefromdate=#{duefromdate} WHERE id=#{id}
    </update>
</mapper>