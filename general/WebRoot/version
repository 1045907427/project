1.版本说明文件

2018-01-10 general_1.1.4
更新内容：
1、修改了销售订单模板导入和代配送销售订单模板导入问题
2、添加新功能：在销售相关单据中，可以按最近客户的最近销售价格取价。
	（1）添加系统参数，销售取价方式：SalesPriceRule
		a）1：默认取价方式。先取促销价，再取合同价，价格套，基准销售价
		b）2：最近销售价。先取促销价，再取最近一次的订单价格，合同价，价格套，基准销售价
		c）3：最近发货价。先取促销价，再取最近一次的发货价格，合同价，价格套，基准销售价
		d）4：最近回单价。先取促销价，再取最近一次的回单价格，合同价，价格套，基准销售价
		注意：取价方式会影响到销售订单、手机端和扫描枪的在线取价、零售单、订单导入（订单导入
		有系统参数isSystemPrice控制是否取导入价格或系统价格）等
	（2）添加系统参数，销售新品是否提醒：CustomerNewBuyRemind
		销售订单，明细添加时，如果是新品的，弹出新品提醒信息。
	（3）添加系统参数，历史销售价显示方式：SalesGoodsHistorySource
		a）1：取发货单数据
		b）2：取回单数据
		该参数会影响到两个地方：1. 销售订单右键查看历史销售价 2. 手机端添加商品查看历史销售价
3、对三方账套凭证对接的功能进行优化，报损调账单、报溢调账单的生成凭证功能上传
4、优化了全局导出的效率
5、销售订货单增加了打印和导出的功能
6、修改了其他入库单和其他出库单导入失败的问题

2017-12-30 general_1.1.3
更新内容：
1、客户合同费用上传，该菜单在费用管理->合同下：
	（1）客户费用条款：建立客户费用合同条款，包含条款编号，条款名称，条款类别，费用类型，返还类型，返还月份，返还条件，对应费用科目，备注
	（2）客户费用合同：客户费用合同档案包括合同主体和合同明细。
			i. 合同主体（主表信息）：包含编号（系统编号），合同编号（可以填写），合同名称，客户类型（分总店和门店），客户编号，联系人，联系方式，
			部门，合同负责人（取人员档案），开始日期，结束日期，供应商，品牌，状态，备注，参考数据来源等
			ii. 合同明细：就是合同条款。通过合同条款档案引用进来。包含条款编号，费用类型，返还类型，返还月份，返还条件，费用计算方式，分摊方式。
			iii. 参考数据来源：计算费用合同的时候，可以按销售额等计算。分数据上报和系统销售。如果设置为数据上报，销售额通过数据上报的销售金额计算，
				 如果设置为系统销售，销售额通过系统的销售计算。
	（3）费用汇总统计报表：
		计算公式：根据合同条款设置的计算。费用总金额=代垫+自理。费用总金额就是根据合同条款中的费用计算公式计算金额。
		默认代垫与费用总金额一致。这些金额可以手动修改。
		功能：
			i.	生成客户合同费用。按照月份，根据客户费用合同，统计生成客户的合同费用。按条款统计。生成的客户费用合同存入数据库，可以标识待定/确认。
			ii.	确认合同费用。确认后，该月份的合同费用数据标记为确认。生成权责金额，按分摊方式计算。
			iii. 取消合同费用。取消后，该月份的合同费用数据标记为未确认
			iiii. 生成客户应付费用和代垫费用。只有确认后的数据才允许生成。客户应付费用生成借方金额。代垫费用生成工厂投入
	（4）客户权责金额报表：费用汇总统计表里确认合同费用后，会生成相应的数据，可按月份、供应商、客户、销售部门、客户业务员进行查询数据
2、得乐康拥有对接上传，该菜单在系统设置->三方账套凭证对接：
	（1）三方账套设置：
		1．	功能点：新增账套。修改，启用禁用等
		2．	账套基本配置：账套名称，接入系统版本，接口方式，对应部门，状态
			i.	接入系统版本（T3，T6，U8等），
			ii.	接口方式（数据库直连，openAPI等）,根据不同的接口方式配置不同的参数。数据库直连：配置数据库IP地址，数据库名，用户名密码，
		3．	账套参数配置。
			a)	基础档案关系。
				i.	用来对双方系统的基础档案数据进行同步，包括供应商，客户，凭证类别，会计科目等。相关操作按钮全部放到基础档案关系这个标签页面下
			b)	业务参数配置
				i.	原先版本的参数配置与业务相关的全部移到该标签页面
				ii.	选择会计科目的时候，当一级科目下存在子科目时，也可以选择。比如选择主营业收入这个一级科目，他底下还有其他子科目。
					科目的匹配是通过会计科目与商品对应关系匹配进去
			c)	相关档案与会计科目对应关系
				i.	银行档案与不同会计科目对应。
				ii.	其他出入库单据中的出入库类型与会计科目对应
				iii.	费用科目类型与会计科目对应。（日常费用和客户费用中的费用科目）
			d)	会计科目与商品对应关系。
				i.	一级科目下的子科目可以与商品对应。比如业务参数中配置，采购传递凭证时，需要传入主营业成本这个一级科目时。
					如果主营业成本在这地方配置了子科目与商品的对应关系，自动按这个关系通过商品匹配对应的会计科目
				ii. 导入模板：A导入方式(1按商品,2按品牌) B商品编码 C品牌编码 D科目编码 E上级科目编码
					上级科目编码：三方帐套设置里，会计科目与商品对应关系下的一级科目列表的会计科目编码（如1001库存现金，编码填写1001）
					科目编码：是上级科目编码下子科目（如100101库存现金-提现，编码填写100101，以此类推）
		4．	凭证生成方式：
			a)	一单一证：一个单据对应一张凭证
			b)	汇总：多个单据汇总到一张凭证
	（2）三方账套凭证日志：
			a)	生成凭证后，需要记录凭证与单据的关系。包括凭证的id,凭证编号，单据编号等信息。
			b)	通过凭证编号可以查询到该凭证是由什么单据组成的。
			c)	使用openAPI时，可以通过openAPI显示凭证列表，点击显示单据列表的方式展示
3、客户应付费用列表改造，该菜单在费用管理->录入->客户应付费用列表：
	（1）可以手动在客户应付费用列表中，输入借方贷方单据，手动录入的单据允许修改。
	（2）同时可以把贷方单据，生成凭证。
	（3）凭证格式，需要在三方账套中设置。配置借方科目，贷方科目。同时可以按找费用科目对应关系，对应到特定科目中去
4、销售订货单改造，该菜单在销售管理->日常业务->销售订货单：
	（1）添加字段提货券编号，可以在列表中查询
	（2）添加系统参数isOrderGoodsUseTax，销售订货单是否含税，默认含税。如果设置不含税，销售订货单，添加明细时，税种档案默认为无税的税种档案。
		 注：添加明细和修改明细，可以根据该系统参数，显示不同的明细添加修改页面。
	（3）销售订货单不含税时，生成的订单都不能含税，当未税处理。包含销售订单，销售发货通知单，发货单，回单等一系列单据都应该按无税的税种处理。
5、未税金额与税额小数位处理：
	系统中，全部的未税金额，税额统一处理成两位。整个系统中设计到的全部按两位处理。可以根据系统参数金额小数位数处理。参考总账方式。
	主要是金额换算的一些方法设置与金额一致的小数位数。注：价格不处理。	
6、操作日期与审核日期改造：
	（1）操作日期不要在登录的时候选择，改成在右上角做操作日期切换。参考总账的方式。操作日期是否允许修改，需要进行权限的控制。
	（2）修改密码这个改成设置，把修改密码，切换日期放入到设置下面。取消登录页面中的选择日期，后台登录，统一默认当天。
	（3）业务单据审核后，业务日期变更方式改造。代码重构。使用统一的方法获取审核后的业务日期。
		相关系统参数：IsAuditBusinessdate，IsOpenBusDate
		系统参数IsAuditBusinessdate改造：添加审核日期取操作日期的功能       
		0：表示审核后业务日期不变        1：表示审核后业务日期取当前日期       2：表示审核后业务日期取操作日期
7、客户金税改造：
	（1）新增功能：
		客户金税开票（菜单：应收管理->客户金税开票）
		注意菜单和按钮都是禁用状态的。
	（2）修改：
		a)	简化ERP系统中开票功能
			由原先的两步法，改为现在的一步（航天开票XML正数导出）
			禁用原先按钮（1航天EXCEL格式导出和2导入生成航天XML格式）
		b)	销售开票明细页面，新增（金税分类编码）隐藏
		c)	商品档案导入金税分类编码时，根据金税分类编码档案进行判断是否在存在 。

2017-12-14 general_1.1.2
更新内容：
    1、手机客户端：
	    （1）添加商品条码扫描功能。在抄单管理中：要货，车销，退货，调拨中都添加了该功能；在数据上报中，客户销售和客户库存也可以扫描商品条码
    	（2）手机调拨单中添加显示金额控制
    2、配送单加入调拨单配送功能：
    	（1）配送单新增时可以选择调拨单
    	（2）配送单交接单列表里，因调拨单没有客户，把仓库作为一个客户计算，如[仓库]日化仓
    	（3）配送单发货明细里，添加了来源类型，区分不同的来源单据
    	（4）调拨单，添加字段isdelivery（配货状态0未配货1配货中2已配货3配货完毕），配送单的审核，反审，验收，反验收都会回写相关单据的配货状态
    	（5）配送单选择调拨单时，调拨单的状态，根据系统参数StatusOfAddDeliverySourceList确认，取保存或者审核通过状态（调拨单审核后就关闭，审核通过状态可以包含审核出库和关闭的状态）。注：调拨单添加了审核出库（审核通过），审核入库（关闭）的功能。该功能把，原先调拨出库和调拨入库同时操作的功能，拆分为两个。
    3、新增菜单：仓库货位管理，该菜单在基础档案->商品下：
    	（1）按仓库，给不同的商品设置货位
    	（2）货位的取法规则：当仓库商品货位存在时，取该货位信息，不存在取商品档案中的货位
    4、销售订单添加销售类型：大宗销售：
    	（1）销售订单添加销售类型的字段，标记为正常销售/大宗销售
	    （2）采购计划分析表，销售数据来源，增加一个大宗销售的类型
    	（3）销售报表中，添加查询条件，销售类型
    5、新增菜单：借货单、还货单，该菜单在库存管理->借货还货下：
    	（1）页面功能参考其它出入库单据，表头功能需要添加借货（还货）人类型，根据不同的类型，选择供应商或者客户。
    	（2）借货单还货单，审核后生成其他出入库单据。借货单生成其他出库单，还货单生成其他入库单。反审时，要先调用反审其他出入库单据的接口。
    	（3）其他出入库单，添加来源类型与来源单据编号。列表添加相关查询条件。其他出入库单据来源类型不是正常单据的，不能反审，只能通过来源单据反审。
    	（4）新增一张报表：借货还货情况表：可以按借货人、部门、品牌、商品合计，统计借货金额、还货金额、欠货金额等
    6、金税功能上传：
	    一、菜单管理【系统设置->基础平台->菜单管理】
	    	（1）菜单管理->按钮列表可以进行批量启用。
	    	（2）菜单管理->停用菜单列表->可以按钮名称和地址进行查询。
    	二、金税档案【基础档案->金税档案】
	    	（1）金税档案，开始时，此菜单和按钮都是禁用的，使用关键字“金税”在停用菜单列表处查询，并启用。
	    	（2）菜单：金税税收分类，此为金税税收分类档案，数据请先导入。注意档案只能新增，不能修改编码，删除时，系统会判断商品档案有无调用。
	    	（3）菜单：税收分类关联商品条形码，此功能用法是，使用条形码去匹配商品档案对应的税收分类。
	    	 说明：实施人员可以从鸿都系统中导出，然后，在客户系统里导入，使用“匹配商品档案”。注意导出前请先“生成关联数据”。实施人员用完后，可以禁用。如果客户有不一样的商品，请让他们做好档案，再导出关联excel做好备份，可以给其他客户使用。
	    	（4）菜单：关联税收分类商品。查看已经关联的税收分类。可以重新关联。
	    	（5）菜单：未关联税收分类商品。
    	三、商品档案【基础档案->商品档案】
    		（1）商品档案里，金税税收分类，使用参照窗口
	    	（2）商品档案->手动更新金税信息，原先金税税收分类，文本框改为参照窗口，必填。
	    四、销售开票【应收管理->抽单->申请开票列表】
    		（1）销售开票查看->导入导出->1.航天Excel格式导出Excel格式字段调整为：【单据号、金税税收分类编码、商品编码、商品名称、单位、数量、未税单价、未税金额、税额、税率、税率名称、金税税收分类名称、导出备注】，去掉原先“金税编码”。
	    	（2）销售开票查看->导入导出->2.导入生成航天信息xml格式。 去掉金税编码。
    7、修复了因多张要货单里含有赠品，导致生成的销售订单里页面出现错位问题
    8、CRM管理-数据上报-客户销量单据列表：客户状态查询页面查询条件【门店类型】修改，新门店表示当前业务日期内有数据，之前没数据的记录；已关门店表示当前业务日期无数据，之前有数据的记录；已开门店表示业务日期及其之前都有数据的记录
    9、借货还货功能修改：来源类型增加拆分单、组装单；原先出入库类型是拆装单组装单的，数据处理到来源类型中去，出入库类型设置为空；显示来源单据编号，拆装单，组装单生成过来时，来源单据编号要带过来
    10、销售退货通知单导入修改：
    	（1）导入时若客户编码中有字母，且字母大小写与客户档案不一致，就不予许导入（销售订单导入也一样）
    	（2）模板导入时，若Excel模板导入多张工作表，允许读取每个工作表里特定位置的客户信息，实现多个工作表多张订单的导入

2017-11-14 general_1.1.1
更新内容：
    1.供应商品牌结算方式上传
    2.销售订货单功能上传
    3.用友U8对接功能上传
    4.销售管理 >> 促销管理 >> 买赠促销 新增保存不了问题修改
    5.欠货单显示不对、报错等问题已修改
    6.修复数据库数据庞大时备份可能出错的问题
    7.打印跳页、空白等问题修改

2018-3-9 2.0.1_release
更新内容：
    主要修改哈尔滨导入模板出错的问题
    
2018-4-14	general_2.2.0
说明：
	general_2.2.0在general2.0.0的基础上，优化了一些操作及功能，修复BUG，增加了一些新功能。
	新功能：
		1、乌鲁木齐融臻鑫美的需求：在手机端和扫描枪上增加了调拨单的出库和入库功能：
			（1）调拨出库单的功能：新增调拨出库、同步调拨出库单；
			（2）调拨入库单：同步调拨入库单、验收入库。
		2、德阳的需求：
			（1）采购入库单：可以添加赠品，该功能参考销售订单的赠品方式，添加商品类型为赠品，金额、单价等都为0，添加赠品按钮做成了按钮权限。
							 扫描枪上也加入了添加赠品功能，添加赠品按钮做成了按钮权限。
			（2）库存树状报表（位置：库存管理->库存查询）：该报表参考库存明细表，可以多级显示；在商品明细可以双击查看库存日志；
								   添加查询条件：汇总类型：总仓库-分仓库-品牌-商品       仓库-品牌-商品     供应商-品牌-商品
			（3）销售情况报表（位置：报表管理->销售报表->销售情况报表）：该报表只统计销售数据，不统计订单和发货通知单；
								   添加查询条件：单据类型（多选），客户单号、单据备注、明细备注（这三个支持模糊查询），显示条形码且可以排序。
			（4）客户分销规则改造：销售订单下单、手机端要货下单会根据客户分销规则取商品；
								   调整客户群的顺序 按客户》总店》销售区域》客户分类》促销分类》信用等级》核销方式排序；
							       报表管理->销售报表->客户商品报表->客户商品报价单：选择客户时，只能查看该客户能销售的商品。
			（5）销售订单里增加显示是否新品，客户第一次购买某个商品是会进行提示，商品前面会显示“新”；
							审核或关闭的销售订单，不会显示新品。
			（6）数据上报改造：
					a. 客户库存上报单据中，添加成本价，成本金额，成本未税金额，零售价，零售金额，零售未税金额，税种档案字段，新增、修改、查看界面都有调整；
					b. 导入功能改造，可以导入成本价、零售价，没有的话默认取商品的成本价和客户销售价格；
					c. 手机上传的单据，成本价取商品的成本，零售价取客户的销售价格；
					d. 原先的报表没有改动，只修改了名称客户库存明细报表、客户销量明细报表；
					e. 新增客户库存销量报表（位置：CRM管理->数据上报）：可以按客户、商品、品牌、客户业务员等小计列；可以按条形码排序。
		3、	广州日高的需求：		
			（1）日常费用录入改造：新增时，不再显示人员，原先只能选择客户业务员，现在可以选择全部人员；
								   添加人员日常费用报表（费用管理->报表）：人员未选择的数据全部归类到未指定人员里；可以按人员、费用科目进行查询。
			（2）OA代垫费用申请单改造：增加6个触发器：生成代垫、生成借方客户费用、生成贷方客户费用、生成冲差单、生成银行借贷单、生成收款单；
									   生成代垫是根据工厂投入的金额生成，其他5个触发器都是根据费用金额生成；驳回时，会生成金额相反的单据。
									   代垫费用冲差申请单表单URL：oa/matcost/oaMatcostPage.do
		4、异常成本报表改造：
			（1）销售成本结算按钮： 根据选择的商品，判断日期内商品的相关全部单据，是否审核验收通过的，如果有未审核或未验收的单据不允许计算；
									不存在则根据全月一次加权平均法重新计算商品的成本；
			（2）相关的全部单据：采购进货单（审核），采购退货出库单（验收），其他出入库单，报损报溢，调拨单、销售发货单，销售退货入库单(验收通过)；
			（3）回写销售成本： 根据日期，修改销售发货单，销售退货入库单中的成本价，成本价为上面重新计算后的成本单价；
								根据发货单和销售退货入库单相关的单据编号，处理上下游相关的全部成本价。包括销售回单，销售核销单据，销售开票单据；
								更新库存的成本价。商品档案中的成本价，库存中的成本价（独立核算）。	
			（4）采购进货单和采购入库单的，入库成本价（addcostprice）回写，按计算入库时的价格回写。
			（5）其他出入库单单据改造：
										其他出库单：出库类型添加出库成本调整		其他入库单：入库类型添加入库成本调整
										只有出入库类为成本调整的，才允许0数量，有金额进行出入库，可以修改含税金额、未税金额；
			（6）库存成本调整按钮：按调整的金额自动选择出库调整或者入库调整，生成出库成本调整类型的其他出入单或者入库成本调整类型的其他入库单；
								   生成时可以选择是否重新计算销售成本。
		5、销售日报表（吉马，位置：报表管理->考核报表）：该报表可以根据品牌业务员查询业务员的业绩；该菜单默认停用。
		6、手机端增加订货单报表：报表查询后，可以在单据明细界面里输入数量生成销售订单。
		7、其他出库单：增加按钮权限“显示单价金额”，该按钮默认停用。停用时，其他出库单只能输入、查看和修改数量；启用时，可以输入、查看和修改数量、金额、未税金额等。
		
2018-4-24	general_2.2.1
说明：
	修复BUG：
		1、（禅道9965、9966）借货单、还货单：保存时，因商品库存可用量不足，导致审核或反审时，提示里有undefined问题；
		2、（禅道9959）销售订单模板导入：因模板设置了客户单号，导致模板导入失败；
		3、（禅道9924）销售日报表：今日发货单金额取销售报表的发货单金额；
		4、（禅道9940。9941）采购计划单、采购订单里查看采购计划分析表里有几列数据显示为0，查询商品为空；
		5、（禅道9912）手机端、扫描枪：调拨单审核出库时提示商品可用量不足。